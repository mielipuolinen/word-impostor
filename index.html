<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b1020" />

  <!-- App metadata (single-file, best-effort PWA + iOS add-to-home) -->
  <meta name="description" id="descMeta" content="Sanahuijari yhdell√§ puhelimella/tabletilla ‚Äî pelaa liven√§." />
  <meta name="application-name" id="appNameMeta" content="Sanahuijari.fi" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" id="appleTitleMeta" content="Sanahuijari.fi" />
  <meta name="format-detection" content="telephone=no" />

  <meta property="og:type" content="website" />
  <meta property="og:title" id="ogTitleMeta" content="Sanahuijari.fi" />
  <meta property="og:description" id="ogDescMeta" content="Sanahuijari yhdell√§ puhelimella/tabletilla ‚Äî pelaa liven√§." />

  <link rel="icon" id="appIcon" type="image/svg+xml" href="" />
  <link rel="apple-touch-icon" id="appleIcon" href="" />
  <link rel="mask-icon" id="maskIcon" color="#7aa7ff" href="" />
  <link rel="manifest" id="manifestLink" href="" />
  <title>Sanahuijari.fi</title>
  <style>
    :root{
      --bg:#0b1020;
      --text:#eef3ff;
      --muted:rgba(238,243,255,.68);
      --muted2:rgba(238,243,255,.52);
      --danger:#ff6b8a;
      --surface: rgba(255,255,255,.060);
      --surface2: rgba(255,255,255,.035);
      --border: rgba(255,255,255,.12);
      --border2: rgba(255,255,255,.16);
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius: 22px;
      --pad: clamp(14px, 3.8vw, 20px);
      --maxw: 680px;
    }

    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 800px at 20% 0%, #1a2a63 0%, var(--bg) 55%) fixed;
      color: var(--text);
      -webkit-tap-highlight-color: transparent;
      overflow-x:hidden;
    }

    /* Layout optimized for phones: top-aligned + safe-area padding */
    .wrap{
      min-height: 100dvh;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding: calc(var(--pad) + env(safe-area-inset-top)) var(--pad) calc(var(--pad) + env(safe-area-inset-bottom));
    }
    .app{
      width:min(100%, var(--maxw));
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    /* Header */
    .head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    h1{
      margin:0;
      font-size: clamp(22px, 5.2vw, 32px);
      letter-spacing:.2px;
      line-height:1.05;
    }

    .brand{ display:flex; flex-direction:column; gap:4px; min-width:0; }
    .tagline{
      font-size: 12px;
      font-weight: 850;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: rgba(238,243,255,.58);
      line-height: 1.15;
      max-width: 100%;
      white-space: normal;
      overflow-wrap: anywhere;
      word-break: break-word;
      hyphens: auto;
    }

    .lang{ display:flex; gap:8px; align-items:center; }
    .langbtn{
      flex:0 0 auto;
      width: 44px;
      height: 32px;
      padding: 0;
      border-radius: 10px;
      font-size: 28px;
      font-weight: 900;
      line-height: 1;
      display:flex;
      align-items:center;
      justify-content:center;
      background: transparent;
      border: 1px solid rgba(255,255,255,.16);
      color: var(--text);
      overflow:hidden;
      box-shadow:none;
    }
    .langbtn.active{
      border-color: rgba(122,167,255,.75);
      box-shadow: 0 0 0 3px rgba(122,167,255,.22);
    }

    /* Surfaces */
    .panel, .card{
      background: linear-gradient(180deg, var(--surface) 0%, var(--surface2) 100%);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panel-inner{ padding: var(--pad); }

    /* Form */
    .row{ display:flex; gap:12px; align-items:center; flex-wrap:wrap }
    .col{ display:flex; flex-direction:column; gap:10px; flex:1 1 220px }

    label{
      font-size: 15px;
      font-weight: 900;
      letter-spacing: .2px;
      color: rgba(238,243,255,.92);
    }

    input[type="number"]{
      width:100%;
      padding: 16px 16px;
      border-radius: 16px;
      border: 1px solid var(--border2);
      background: rgba(0,0,0,.18);
      color: var(--text);
      font-size: 18px;
      font-weight: 800;
      outline:none;
    }
    input[type="number"]:focus{
      border-color: rgba(122,167,255,.65);
      box-shadow: 0 0 0 4px rgba(122,167,255,.18);
    }

    /* Buttons */
    .btns{ display:flex; gap:12px; flex-wrap:wrap; margin-top: 12px; }
    button{
      appearance:none;
      border:none;
      border-radius: 18px;
      padding: 16px 16px;
      min-height: 56px;
      font-size: clamp(16px, 4.4vw, 18px);
      font-weight: 900;
      cursor:pointer;
      user-select:none;
      color: var(--text);
      background: rgba(255,255,255,.08);
      border: 1px solid var(--border);
      box-shadow: 0 12px 28px rgba(0,0,0,.24);
      transition: transform .08s ease, filter .08s ease, background .15s ease, box-shadow .15s ease;
      touch-action: manipulation;
      flex: 1 1 180px;
      white-space: normal;
      line-height: 1.1;
    }
    button:active{ transform: translateY(1px) scale(.99); filter: brightness(1.03); }

    button:focus-visible,
    input:focus-visible{
      outline: none;
      box-shadow: 0 0 0 4px rgba(122,167,255,.22), 0 12px 28px rgba(0,0,0,.24);
    }

    .primary{
      background: linear-gradient(180deg, rgba(122,167,255,.98) 0%, rgba(84,133,255,.94) 100%);
      border-color: rgba(122,167,255,.55);
      color: #08102a;
      box-shadow: 0 18px 45px rgba(0,0,0,.34);
    }

    /* Quick player buttons */
    .quick{ display:flex; gap:10px; flex-wrap:wrap; }
    .quickbtn{
      flex: 1 1 64px;
      padding: 14px 0;
      min-height: 52px;
      font-size: 18px;
      font-weight: 950;
      border-radius: 18px;
      box-shadow: none;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }
    .quickbtn.active{
      background: linear-gradient(180deg, rgba(122,167,255,.98) 0%, rgba(84,133,255,.94) 100%);
      border-color: rgba(122,167,255,.55);
      color:#08102a;
    }

    /* Segmented control (difficulty) */
    .seg{ display:flex; gap:10px; flex-wrap:wrap; }
    .segbtn{
      flex: 1 1 120px;
      min-height: 52px;
      padding: 14px 10px;
      border-radius: 18px;
      box-shadow:none;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      font-weight: 950;
    }
    .segbtn.active{
      background: linear-gradient(180deg, rgba(122,167,255,.98) 0%, rgba(84,133,255,.94) 100%);
      border-color: rgba(122,167,255,.55);
      color:#08102a;
    }

    /* Category chips */
    .chips{ display:flex; gap:10px; flex-wrap:wrap; }
    .chip{
      flex: 0 0 auto;
      min-height: 44px;
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 15px;
      font-weight: 950;
      box-shadow:none;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }
    .chip.active{
      background: linear-gradient(180deg, rgba(122,167,255,.98) 0%, rgba(84,133,255,.94) 100%);
      border-color: rgba(122,167,255,.55);
      color:#08102a;
    }

    /* Special logo chip (Kinojuha) */
    .chip.logo{
      padding: 8px 12px;
      min-height: 44px;
    }
    .chip.logo img{
      display:block;
      height: 22px;
      width:auto;
      max-width: 140px;
      object-fit: contain;
      filter: drop-shadow(0 6px 12px rgba(0,0,0,.28));
    }
    .chip.logo.active img{ filter: none; }

    /* Settings toggles (full-row pill) */
    .toggle{
      display:block;
      width:100%;
      cursor:pointer;
      user-select:none;
      margin-top: 12px;
    }
    .toggle input{
      position:absolute;
      opacity:0;
      pointer-events:none;
      width:1px;
      height:1px;
    }
    .toggle-ui{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 14px 16px;
      border-radius: 18px;
      background: rgba(0,0,0,.16);
      border: 1px solid rgba(255,255,255,.10);
      transition: background .15s ease, border-color .15s ease, transform .08s ease, filter .08s ease;
      box-shadow: 0 12px 28px rgba(0,0,0,.18);
      min-height: 56px;
    }
    .toggle:active .toggle-ui{ transform: translateY(1px) scale(.995); filter: brightness(1.03); }
    .toggle-name{
      font-weight: 950;
      font-size: 16px;
      line-height: 1.15;
      color: rgba(238,243,255,.95);
      flex: 1 1 auto;
      min-width: 0;
    }
    .toggle-pill{
      flex: 0 0 auto;
      font-weight: 1000;
      font-size: 13px;
      letter-spacing: .06em;
      text-transform: uppercase;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(238,243,255,.92);
      white-space: nowrap;
    }

    .toggle input:focus-visible + .toggle-ui{
      outline: none;
      box-shadow: 0 0 0 4px rgba(122,167,255,.22), 0 12px 28px rgba(0,0,0,.24);
      border-color: rgba(122,167,255,.55);
    }

    .toggle input:checked + .toggle-ui{
      background: linear-gradient(180deg, rgba(122,167,255,.98) 0%, rgba(84,133,255,.94) 100%);
      border-color: rgba(122,167,255,.55);
    }
    .toggle input:checked + .toggle-ui .toggle-name{ color:#08102a; }
    .toggle input:checked + .toggle-ui .toggle-pill{
      background: rgba(0,0,0,.14);
      border-color: rgba(0,0,0,.10);
      color:#08102a;
    }

    /* Dealing header */
    .topline{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom: 12px;
    }
    .player{
      font-size: clamp(20px, 5.0vw, 26px);
      font-weight: 950;
      letter-spacing:.2px;
    }
    .progress{ color: var(--muted); font-size: 14px; font-weight: 850; }

    /* Cards */
    .card-face{
      padding: 22px var(--pad);
      display:flex;
      flex-direction:column;
      gap:16px;
      min-height: clamp(320px, 52vh, 520px);
      justify-content:center;
      text-align:center;
    }

    /* Make WORD/SANA label readable */
    .card-title{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      margin: 0 auto;
      padding: 10px 14px;
      border-radius: 999px;
      font-size: 14px;
      font-weight: 950;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: rgba(238,243,255,.95);
      background: rgba(0,0,0,.20);
      border: 1px solid rgba(255,255,255,.16);
    }

    .card-main{
      font-size: clamp(36px, 8.8vw, 56px);
      font-weight: 1000;
      letter-spacing: .3px;
      line-height: 1.04;
      word-break: break-word;
    }
    .card-main.imposter{ color: var(--danger); }

    .hintbox{
      margin-top: 0;
      padding: 16px 16px;
      border-radius: 22px;
      border: 1px solid rgba(122,167,255,.22);
      background: linear-gradient(180deg, rgba(255,255,255,.06) 0%, rgba(0,0,0,.12) 100%);
      box-shadow: 0 14px 34px rgba(0,0,0,.26), inset 0 1px 0 rgba(255,255,255,.10);
      text-align:center;
      position: relative;
      overflow:hidden;
    }
    .hintbox::before{
      content:"";
      position:absolute;
      inset:-40% -30%;
      background: radial-gradient(closest-side at 35% 35%, rgba(122,167,255,.55), rgba(122,167,255,0));
      opacity:.14;
      transform: rotate(8deg);
      pointer-events:none;
    }
    .hintbox .label{
      font-size: 11px;
      color: rgba(238,243,255,.74);
      letter-spacing:.22em;
      text-transform: uppercase;
      margin-bottom: 10px;
      font-weight: 1000;
      position: relative;
      z-index: 1;
    }
    .hintbox .value{
      font-size: clamp(20px, 5.6vw, 28px);
      font-weight: 1000;
      line-height: 1.12;
      letter-spacing: .2px;
      color: rgba(238,243,255,.96);
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 18px;
      padding: 12px 12px;
      word-break: break-word;
      position: relative;
      z-index: 1;
    }

    /* Done screen */
    .done-face{
      min-height: clamp(280px, 44vh, 480px);
      gap: 14px;
    }
    .done-title{
      font-size: clamp(28px, 6.8vw, 40px);
      font-weight: 1000;
      letter-spacing: .2px;
      line-height: 1.05;
    }
    .done-sub{
      font-size: clamp(16px, 4.6vw, 18px);
      font-weight: 850;
      color: var(--muted);
      line-height: 1.25;
    }

    /* Big tap CTA for Reveal / Close */
    .tap{
      width: 100%;
      padding: 26px 18px;
      border-radius: 22px;
      border: 1px solid rgba(122,167,255,.62);
      background: linear-gradient(180deg, rgba(122,167,255,.98) 0%, rgba(84,133,255,.94) 100%);
      color:#08102a;
      font-weight: 1000;
      font-size: clamp(20px, 5.3vw, 28px);
      letter-spacing: .1px;
      box-shadow: 0 18px 45px rgba(0,0,0,.35);
      position: relative;
      overflow:hidden;
      min-height: 70px;
    }
    .tap::before{
      content:"";
      position:absolute;
      inset:-40% -30%;
      background: radial-gradient(closest-side at 30% 30%, rgba(255,255,255,.60), rgba(255,255,255,0));
      opacity:.22;
      transform: rotate(10deg);
      pointer-events:none;
    }
    .tap::after{
      content:"‚Ä∫";
      position:absolute;
      right: 18px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 30px;
      opacity: .55;
      pointer-events:none;
    }
    .passbtn::after{ content:"‚Üí"; opacity: .65; }

    .hidden{ display:none !important; }

    @media (prefers-reduced-motion: reduce){
      *{ transition: none !important; }
    }

    /* Footer */
    .footer{
      position: relative;
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 10px;
      text-align: center;
      font-size: 12px;
      font-weight: 850;
      color: var(--muted2);
      padding: 10px 10px;
      margin-top: 6px;
      user-select: none;
    }

    .footertext{
      grid-column: 1 / -1;
      grid-row: 1;
      justify-self: center;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:2px;
      line-height: 1.2;
      padding: 0 10px;
      /* Reserve equal space on both sides so the text stays truly centered, even with right-side buttons */
      padding-left: 92px;
      padding-right: 92px;
      pointer-events: none;
      max-width: 100%;
    }
    .footerline{
      pointer-events: none;
      white-space: normal;
      overflow-wrap: anywhere;
      word-break: break-word;
      hyphens: auto;
      max-width: 100%;
    }
    .footerline.top{
      color: rgba(238,243,255,.66);
      font-weight: 950;
      letter-spacing: .04em;
    }

    .footactions{
      grid-column: 2;
      grid-row: 1;
      justify-self: end;
      display:flex;
      gap:8px;
      align-items:center;
    }

    .footbtn{
      appearance:none;
      border:none;
      width: 36px;
      height: 30px;
      min-height: 30px;
      padding: 0;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 900;
      line-height: 1;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: none;
      opacity: .70;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, filter .08s ease, opacity .15s ease, background .15s ease, box-shadow .15s ease;
    }

    .footbtn:active{ transform: translateY(1px) scale(.99); filter: brightness(1.03); }
    .footbtn.active{
      opacity: 1;
      border-color: rgba(122,167,255,.75);
      box-shadow: 0 0 0 3px rgba(122,167,255,.18);
      background: rgba(255,255,255,.06);
    }

    /* If you ever add left-side buttons later, this keeps text centered */
    @media (max-width: 380px){
      .footertext{ padding-left: 82px; padding-right: 82px; }
      .footbtn{ width: 34px; }
    }
    .toast{
      position: fixed;
      left: 50%;
      bottom: calc(10px + env(safe-area-inset-bottom));
      transform: translateX(-50%);
      z-index: 999;
      max-width: min(560px, calc(100vw - 24px));
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(238,243,255,.92);
      font-size: 13px;
      font-weight: 900;
      letter-spacing: .2px;
      box-shadow: 0 18px 50px rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      user-select:none;
      text-align:center;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="app">
      <div class="head">
        <div class="brand">
          <h1 id="titleText">Sanahuijari.fi</h1>
          <div class="tagline" id="taglineText">Pelaa liven√§ yhdell√§ laitteella</div>
        </div>
        <div class="lang" role="group" aria-label="Language">
          <button class="langbtn" type="button" id="langEn" aria-label="English" title="English">üá¨üáß</button>
          <button class="langbtn" type="button" id="langFi" aria-label="Suomi" title="Suomi">üá´üáÆ</button>
        </div>
      </div>

      <!-- SETUP -->
      <section class="panel" id="setupPanel">
        <div class="panel-inner">
          <div class="row">
            <div class="col">
              <label id="playersLabel">Number of players</label>
              <div class="quick" id="playerQuick" role="group" aria-label="Player count">
                <button class="quickbtn" type="button" data-count="3">3</button>
                <button class="quickbtn" type="button" data-count="4">4</button>
                <button class="quickbtn" type="button" data-count="5">5</button>
                <button class="quickbtn" type="button" data-count="6">6</button>
                <button class="quickbtn" type="button" data-count="custom" id="customBtn">Custom</button>
              </div>
              <input id="playersInput" class="hidden" type="number" inputmode="numeric" min="3" value="5" />
            </div>
          </div>

          <div class="row" style="margin-top:10px;">
            <div class="col">
              <label id="difficultyLabel">Vaikeustaso</label>
              <div class="seg" id="difficultySeg" role="group" aria-label="Difficulty">
                <button class="segbtn" type="button" data-diff="all" id="diffAll">All</button>
                <button class="segbtn" type="button" data-diff="easy" id="diffEasy">Easy</button>
                <button class="segbtn" type="button" data-diff="medium" id="diffMedium">Medium</button>
                <button class="segbtn" type="button" data-diff="hard" id="diffHard">Hard</button>
              </div>
            </div>
          </div>

          <div class="row" style="margin-top:10px;">
            <div class="col">
              <label id="categoriesLabel">Sanaluokat</label>
              <div class="chips" id="categoryChips" role="group" aria-label="Categories"></div>
            </div>
          </div>

          <label class="toggle" aria-label="Impostor hint">
            <input id="impostorHintToggle" type="checkbox" />
            <span class="toggle-ui">
              <span class="toggle-name" id="impostorHintName">Huijari: Luokkavihje</span>
              <span class="toggle-pill" id="impostorHintState">Off</span>
            </span>
          </label>

          <label class="toggle" aria-label="Hidden impostor">
            <input id="hiddenImpostorToggle" type="checkbox" />
            <span class="toggle-ui">
              <span class="toggle-name" id="hiddenImpostorName">Huijari: Saa v√§√§r√§n sanan</span>
              <span class="toggle-pill" id="hiddenImpostorState">Off</span>
            </span>
          </label>

          <div class="btns">
            <button class="primary" id="startBtn">Start</button>
          </div>
        </div>
      </section>

      <!-- DEALING -->
      <section class="panel hidden" id="dealPanel">
        <div class="panel-inner">
          <div class="topline">
            <div class="player" id="playerHeading">Player 1</div>
            <div class="progress" id="progressText" aria-live="polite">1 / 5</div>
          </div>

          <div class="card">
            <!-- FACE DOWN -->
            <div class="card-face" id="faceDown">
              <button class="tap" id="revealBtn">Reveal the card</button>
            </div>

            <!-- FACE UP -->
            <div class="card-face hidden" id="faceUp">
              <div class="card-title" id="cardLabel">WORD</div>
              <div class="card-main" id="cardMain">PINEAPPLE</div>

              <div class="hintbox hidden" id="impostorHintBox" aria-live="polite">
                <div class="label" id="impostorHintLabel">CATEGORIES</div>
                <div class="value" id="impostorHintText">Food</div>
              </div>

              <div class="btns" style="margin-top:8px;">
                <button class="tap passbtn" id="closeCardBtn">Close &amp; Pass to the next player</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- DONE -->
      <section class="panel hidden" id="donePanel">
        <div class="panel-inner">
          <div class="card">
            <div class="card-face done-face">
              <div class="done-title" id="doneText">Start playing</div>
              <div class="done-sub" id="doneSub">All players have seen their cards.</div>
              <div class="btns">
                <button class="primary" id="newGameBtn">New game</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <footer class="footer">
        <div class="footertext" aria-hidden="true">
          <div class="footerline top" id="footerTop">sanahuijari.fi ¬∑ v1.51</div>
          <div class="footerline" id="footerBottom">Teko√§lyn tekem√§ ‚ù§Ô∏è ‚Äî 0 % ihmiskoodia.</div>
        </div>
        <div class="footactions" aria-label="Links">
          <button class="footbtn" type="button" id="repoBtn" aria-label="GitHub" title="GitHub">üêô</button>
          <button class="footbtn" type="button" id="selfTestBtn" aria-label="Self-test" title="Self-test">üß™</button>
        </div>
      </footer>
      <div class="toast hidden" id="toast" aria-live="polite"></div>
    </div>
  </div>

  <!-- WORD DATA -->
  <script id="wordData" type="application/json">
  {
    "words": [
      {"en":"Airport","fi":"Lentokentt√§","cats":["place"]},
      {"en":"Astronaut","fi":"Astronautti","cats":["person","space"]},
      {"en":"Backpack","fi":"Reppu","cats":["thing"]},
      {"en":"Bakery","fi":"Leipomo","cats":["place"]},
      {"en":"Bamboo","fi":"Bambu","cats":["nature"]},
      {"en":"Banana","fi":"Banaani","cats":["food","nature"]},
      {"en":"Bicycle","fi":"Polkupy√∂r√§","cats":["vehicle"]},
      {"en":"Blizzard","fi":"Lumimyrsky","cats":["nature"]},
      {"en":"Camera","fi":"Kamera","cats":["thing"]},
      {"en":"Castle","fi":"Linna","cats":["place"]},
      {"en":"Chocolate","fi":"Suklaa","cats":["food"]},
      {"en":"Crocodile","fi":"Krokotiili","cats":["animal"]},
      {"en":"Eclipse","fi":"Pimennys","cats":["space"],"diff":"medium"},
      {"en":"Galaxy","fi":"Galaksi","cats":["space"],"diff":"hard"},
      {"en":"Hamburger","fi":"Hampurilainen","cats":["food"],"diff":"medium"},
      {"en":"Ice cream","fi":"J√§√§tel√∂","cats":["food"],"diff":"easy"},
      {"en":"Library","fi":"Kirjasto","cats":["place"]},
      {"en":"Ninja","fi":"Ninja","cats":["person"],"diff":"hard"},
      {"en":"Pineapple","fi":"Ananas","cats":["food","nature"],"diff":"easy"},
      {"en":"Planet","fi":"Planeetta","cats":["space"],"diff":"medium"},
      {"en":"Rocket","fi":"Raketti","cats":["space","vehicle"],"diff":"medium"},
      {"en":"Spaceship","fi":"Avaruusalus","cats":["space","vehicle"],"diff":"hard"},
      {"en":"Telescope","fi":"Kaukoputki","cats":["thing","space"],"diff":"hard"},

      {"en":"Helsinki","fi":"Helsinki","cats":["place","suomi"],"diff":"easy"},
      {"en":"Tampere","fi":"Tampere","cats":["place","suomi"],"diff":"easy"},
      {"en":"Turku","fi":"Turku","cats":["place","suomi"],"diff":"easy"},
      {"en":"Oulu","fi":"Oulu","cats":["place","suomi"],"diff":"easy"},
      {"en":"Rovaniemi","fi":"Rovaniemi","cats":["place","suomi"],"diff":"medium"},
      {"en":"Lapland","fi":"Lappi","cats":["place","nature","suomi"],"diff":"medium"},
      {"en":"Suomenlinna","fi":"Suomenlinna","cats":["place","suomi"],"diff":"hard"},
      {"en":"Saimaa","fi":"Saimaa","cats":["place","nature","suomi"],"diff":"easy"},
      {"en":"Archipelago","fi":"Saaristo","cats":["nature","place","suomi"],"diff":"medium"},

      {"en":"Reindeer","fi":"Poro","cats":["animal","suomi"],"diff":"easy"},
      {"en":"Whooper swan","fi":"Laulujoutsen","cats":["animal","suomi"],"diff":"hard"},

      {"en":"Northern lights","fi":"Revontulet","cats":["nature","space","suomi"],"diff":"hard"},
      {"en":"Midnight sun","fi":"Y√∂t√∂n y√∂","cats":["nature","space","suomi"],"diff":"medium"},

      {"en":"Karjalanpiirakka","fi":"Karjalanpiirakka","cats":["food","suomi"],"diff":"hard"},
      {"en":"Korvapuusti","fi":"Korvapuusti","cats":["food","suomi"],"diff":"medium"},
      {"en":"Salmiakki","fi":"Salmiakki","cats":["food","suomi"],"diff":"medium"},
      {"en":"M√§mmi","fi":"M√§mmi","cats":["food","suomi"],"diff":"easy"},
      {"en":"Ruisleip√§","fi":"Ruisleip√§","cats":["food","suomi"],"diff":"medium"},
      {"en":"Lohikeitto","fi":"Lohikeitto","cats":["food","suomi"],"diff":"medium"},
      {"en":"Poronk√§ristys","fi":"Poronk√§ristys","cats":["food","suomi"],"diff":"hard"},
      {"en":"Gl√∂gi","fi":"Gl√∂gi","cats":["food","suomi"],"diff":"easy"},
      {"en":"Sima","fi":"Sima","cats":["food","suomi"],"diff":"easy"},
      {"en":"Leip√§juusto","fi":"Leip√§juusto","cats":["food","suomi"],"diff":"hard"},
      {"en":"Mustikkapiirakka","fi":"Mustikkapiirakka","cats":["food","suomi"],"diff":"hard"},

      {"en":"Sauna","fi":"Sauna","cats":["activity","suomi"],"diff":"easy"},
      {"en":"May Day","fi":"Vappu","cats":["activity","suomi"],"diff":"easy"},
      {"en":"Midsummer","fi":"Juhannus","cats":["activity","suomi"],"diff":"medium"},
      {"en":"Independence Day","fi":"Itsen√§isyysp√§iv√§","cats":["activity","suomi"],"diff":"hard"},

      {"en":"Moomin","fi":"Muumipeikko","cats":["person","suomi"],"diff":"medium"},
      {"en":"Santa Claus","fi":"Joulupukki","cats":["person","suomi"],"diff":"medium"},
      {"en":"Kalevala","fi":"Kalevala","cats":["thing","suomi"],"diff":"medium"},

      {"en":"Kimi R√§ikk√∂nen","fi":"Kimi R√§ikk√∂nen","cats":["person","suomi"],"diff":"hard"},
      {"en":"Sanna Marin","fi":"Sanna Marin","cats":["person","suomi"],"diff":"medium"},
      {"en":"Ismo Leikola","fi":"Ismo Leikola","cats":["person","suomi"],"diff":"hard"},
      {"en":"Darude","fi":"Darude","cats":["person","suomi"],"diff":"medium"},
      {"en":"Lordi","fi":"Lordi","cats":["person","suomi"],"diff":"easy"},

      {"en":"Comet","fi":"Komeetta","cats":["space"],"diff":"easy"},
      {"en":"Nebula","fi":"Kaassumu","cats":["space"],"diff":"hard"},
      {"en":"Black hole","fi":"Musta aukko","cats":["space"],"diff":"hard"},
      {"en":"Supernova","fi":"Supernova","cats":["space"],"diff":"hard"},
      {"en":"Asteroid belt","fi":"Asteroidivy√∂","cats":["space"],"diff":"hard"},
      {"en":"Space station","fi":"Avaruusasema","cats":["space"],"diff":"medium"},
      {"en":"Satellite","fi":"Satelliitti","cats":["space","thing"],"diff":"medium"},
      {"en":"Meteor shower","fi":"Meteorisade","cats":["space","nature"],"diff":"hard"},
      {"en":"Gravity","fi":"Painovoima","cats":["space"],"diff":"medium"},
      {"en":"Orbit","fi":"Kiertorata","cats":["space"],"diff":"medium"},
      {"en":"Mars","fi":"Mars","cats":["space"],"diff":"easy"},
      {"en":"Jupiter","fi":"Jupiter","cats":["space"],"diff":"easy"},
      {"en":"Saturn","fi":"Saturnus","cats":["space"],"diff":"easy"},
      {"en":"Moon crater","fi":"Kuun kraatteri","cats":["space"],"diff":"hard"},
      {"en":"Space suit","fi":"Avaruuspuku","cats":["space","thing"],"diff":"medium"},
      {"en":"Launch pad","fi":"Laukaisualusta","cats":["space","place"],"diff":"hard"},
      {"en":"Solar flare","fi":"Auringonpurkaus","cats":["space","nature"],"diff":"hard"},
      {"en":"Constellation","fi":"T√§htikuvio","cats":["space"],"diff":"hard"},
      {"en":"Milky Way","fi":"Linnunrata","cats":["space"],"diff":"hard"},
      {"en":"Vacuum","fi":"Tyhji√∂","cats":["space"],"diff":"medium"},
      {"en":"Light-year","fi":"Valovuosi","cats":["space"],"diff":"hard"},
      {"en":"Exoplanet","fi":"Eksoplaneetta","cats":["space"],"diff":"hard"},
      {"en":"Alien","fi":"Avaruusolio","cats":["space","person"],"diff":"medium"},
      {"en":"Dark matter","fi":"Pime√§ aine","cats":["space"],"diff":"hard"},

      {"en":"Pasta","fi":"Pasta","cats":["food"],"diff":"easy"},
      {"en":"Pizza","fi":"Pizza","cats":["food"],"diff":"easy"},
      {"en":"Sushi","fi":"Sushi","cats":["food"],"diff":"easy"},
      {"en":"Tacos","fi":"Tacot","cats":["food"],"diff":"medium"},
      {"en":"Pancake","fi":"Pannukakku","cats":["food"],"diff":"medium"},
      {"en":"Waffle","fi":"Vohveli","cats":["food"],"diff":"medium"},
      {"en":"Cheese","fi":"Juusto","cats":["food"],"diff":"easy"},
      {"en":"Tomato","fi":"Tomaatti","cats":["food","nature"],"diff":"easy"},
      {"en":"Avocado","fi":"Avokado","cats":["food","nature"],"diff":"medium"},
      {"en":"Blueberry","fi":"Mustikka","cats":["food","nature"],"diff":"medium"},
      {"en":"Strawberry","fi":"Mansikka","cats":["food","nature"],"diff":"medium"},
      {"en":"Mushroom","fi":"Sieni","cats":["food","nature"],"diff":"medium"},
      {"en":"Garlic","fi":"Valkosipuli","cats":["food"],"diff":"hard"},
      {"en":"Cinnamon","fi":"Kaneli","cats":["food"],"diff":"medium"},
      {"en":"Honey","fi":"Hunaja","cats":["food","nature"],"diff":"medium"},
      {"en":"Yogurt","fi":"Jogurtti","cats":["food"],"diff":"medium"},
      {"en":"Coffee","fi":"Kahvi","cats":["food"],"diff":"easy"},
      {"en":"Tea","fi":"Tee","cats":["food"],"diff":"easy"},
      {"en":"Lemon","fi":"Sitruuna","cats":["food","nature"],"diff":"medium"},
      {"en":"Watermelon","fi":"Vesimeloni","cats":["food","nature"],"diff":"hard"},
      {"en":"Soup","fi":"Keitto","cats":["food"],"diff":"easy"},
      {"en":"Curry","fi":"Curry","cats":["food"],"diff":"medium"},
      {"en":"Chocolate cake","fi":"Suklaakakku","cats":["food"],"diff":"hard"},
      {"en":"Popcorn","fi":"Popcorn","cats":["food"],"diff":"easy"},

      {"en":"Lion","fi":"Leijona","cats":["animal"],"diff":"easy"},
      {"en":"Tiger","fi":"Tiikeri","cats":["animal"],"diff":"easy"},
      {"en":"Elephant","fi":"Elefantti","cats":["animal"],"diff":"easy"},
      {"en":"Giraffe","fi":"Kirahvi","cats":["animal"],"diff":"medium"},
      {"en":"Zebra","fi":"Seepra","cats":["animal"],"diff":"easy"},
      {"en":"Penguin","fi":"Pingviini","cats":["animal"],"diff":"medium"},
      {"en":"Dolphin","fi":"Delfiini","cats":["animal"],"diff":"medium"},
      {"en":"Shark","fi":"Hai","cats":["animal"],"diff":"easy"},
      {"en":"Octopus","fi":"Mustekala","cats":["animal"],"diff":"medium"},
      {"en":"Owl","fi":"P√∂ll√∂","cats":["animal"],"diff":"medium"},
      {"en":"Fox","fi":"Kettu","cats":["animal"],"diff":"easy"},
      {"en":"Bear","fi":"Karhu","cats":["animal"],"diff":"easy"},
      {"en":"Wolf","fi":"Susi","cats":["animal"],"diff":"easy"},
      {"en":"Rabbit","fi":"Kani","cats":["animal"],"diff":"easy"},
      {"en":"Squirrel","fi":"Orava","cats":["animal"],"diff":"medium"},
      {"en":"Horse","fi":"Hevonen","cats":["animal"],"diff":"easy"},
      {"en":"Cow","fi":"Lehm√§","cats":["animal"],"diff":"easy"},
      {"en":"Sheep","fi":"Lammas","cats":["animal"],"diff":"easy"},
      {"en":"Goat","fi":"Vuohi","cats":["animal"],"diff":"easy"},
      {"en":"Pig","fi":"Sika","cats":["animal"],"diff":"easy"},
      {"en":"Kangaroo","fi":"Kenguru","cats":["animal"],"diff":"medium"},
      {"en":"Koala","fi":"Koala","cats":["animal"],"diff":"medium"},
      {"en":"Eagle","fi":"Kotka","cats":["animal"],"diff":"medium"},
      {"en":"Turtle","fi":"Kilpikonna","cats":["animal"],"diff":"medium"},

      {"en":"Doctor","fi":"L√§√§k√§ri","cats":["person"],"diff":"easy"},
      {"en":"Teacher","fi":"Opettaja","cats":["person"],"diff":"easy"},
      {"en":"Firefighter","fi":"Palomies","cats":["person"],"diff":"hard"},
      {"en":"Detective","fi":"Etsiv√§","cats":["person"],"diff":"medium"},
      {"en":"Chef","fi":"Kokki","cats":["person","food"],"diff":"easy"},
      {"en":"Astronomer","fi":"T√§htitieteilij√§","cats":["person","space"],"diff":"hard"},
      {"en":"Pilot","fi":"Lent√§j√§","cats":["person","vehicle"],"diff":"medium"},
      {"en":"Musician","fi":"Muusikko","cats":["person"],"diff":"medium"},
      {"en":"Painter","fi":"Maalari","cats":["person"],"diff":"medium"},
      {"en":"Photographer","fi":"Valokuvaaja","cats":["person"],"diff":"hard"},
      {"en":"Gardener","fi":"Puutarhuri","cats":["person","nature"],"diff":"hard"},
      {"en":"Carpenter","fi":"Puusepp√§","cats":["person"],"diff":"hard"},
      {"en":"Engineer","fi":"Insin√∂√∂ri","cats":["person"],"diff":"hard"},
      {"en":"Scientist","fi":"Tiedemies","cats":["person"],"diff":"medium"},
      {"en":"Nurse","fi":"Sairaanhoitaja","cats":["person"],"diff":"hard"},
      {"en":"Athlete","fi":"Urheilija","cats":["person","activity"],"diff":"medium"},
      {"en":"Singer","fi":"Laulaja","cats":["person"],"diff":"medium"},
      {"en":"Actor","fi":"N√§yttelij√§","cats":["person"],"diff":"medium"},
      {"en":"Dentist","fi":"Hammasl√§√§k√§ri","cats":["person"],"diff":"hard"},
      {"en":"Plumber","fi":"Putkimies","cats":["person"],"diff":"hard"},
      {"en":"Programmer","fi":"Ohjelmoija","cats":["person","thing"],"diff":"hard"},
      {"en":"Barber","fi":"Parturi","cats":["person"],"diff":"medium"},
      {"en":"Journalist","fi":"Toimittaja","cats":["person"],"diff":"hard"},
      {"en":"Judge","fi":"Tuomari","cats":["person"],"diff":"medium"},

      {"en":"Car","fi":"Auto","cats":["vehicle"],"diff":"easy"},
      {"en":"Truck","fi":"Rekka","cats":["vehicle"],"diff":"easy"},
      {"en":"Bus","fi":"Bussi","cats":["vehicle"],"diff":"easy"},
      {"en":"Train","fi":"Juna","cats":["vehicle"],"diff":"easy"},
      {"en":"Tram","fi":"Raitiovaunu","cats":["vehicle"],"diff":"medium"},
      {"en":"Subway","fi":"Metro","cats":["vehicle"],"diff":"medium"},
      {"en":"Motorcycle","fi":"Moottoripy√∂r√§","cats":["vehicle"],"diff":"hard"},
      {"en":"Scooter","fi":"Skootteri","cats":["vehicle"],"diff":"medium"},
      {"en":"Ship","fi":"Laiva","cats":["vehicle"],"diff":"easy"},
      {"en":"Boat","fi":"Vene","cats":["vehicle"],"diff":"easy"},
      {"en":"Ferry","fi":"Lautta","cats":["vehicle"],"diff":"easy"},
      {"en":"Helicopter","fi":"Helikopteri","cats":["vehicle"],"diff":"hard"},
      {"en":"Airplane","fi":"Lentokone","cats":["vehicle"],"diff":"medium"},
      {"en":"Jet","fi":"Suihkukone","cats":["vehicle"],"diff":"medium"},
      {"en":"Hot air balloon","fi":"Kuumailmapallo","cats":["vehicle"],"diff":"hard"},
      {"en":"Skateboard","fi":"Rullalauta","cats":["vehicle","activity"],"diff":"medium"},
      {"en":"Snowmobile","fi":"Moottorikelkka","cats":["vehicle"],"diff":"hard"},
      {"en":"Tractor","fi":"Traktori","cats":["vehicle"],"diff":"medium"},
      {"en":"Ambulance","fi":"Ambulanssi","cats":["vehicle"],"diff":"hard"},
      {"en":"Police car","fi":"Poliisiauto","cats":["vehicle"],"diff":"hard"},
      {"en":"Fire truck","fi":"Paloauto","cats":["vehicle"],"diff":"hard"},
      {"en":"Sailboat","fi":"Purjevene","cats":["vehicle"],"diff":"medium"},
      {"en":"Canoe","fi":"Kanootti","cats":["vehicle"],"diff":"medium"},
      {"en":"Tank","fi":"Panssarivaunu","cats":["vehicle"],"diff":"medium"},

      {"en":"Hospital","fi":"Sairaala","cats":["place"],"diff":"medium"},
      {"en":"School","fi":"Koulu","cats":["place"],"diff":"easy"},
      {"en":"Stadium","fi":"Stadion","cats":["place"],"diff":"medium"},
      {"en":"Museum","fi":"Museo","cats":["place"],"diff":"medium"},
      {"en":"Zoo","fi":"El√§intarha","cats":["place","animal"],"diff":"easy"},
      {"en":"Aquarium","fi":"Akvaario","cats":["place","animal"],"diff":"hard"},
      {"en":"Park","fi":"Puisto","cats":["place","nature"],"diff":"easy"},
      {"en":"Beach","fi":"Ranta","cats":["place","nature"],"diff":"easy"},
      {"en":"Mountain","fi":"Vuori","cats":["place","nature"],"diff":"medium"},
      {"en":"Forest","fi":"Mets√§","cats":["place","nature"],"diff":"easy"},
      {"en":"Desert","fi":"Aavikko","cats":["place","nature"],"diff":"medium"},
      {"en":"Island","fi":"Saari","cats":["place","nature"],"diff":"easy"},
      {"en":"Bridge","fi":"Silta","cats":["place","thing"],"diff":"easy"},
      {"en":"Harbor","fi":"Satama","cats":["place"],"diff":"medium"},
      {"en":"Market","fi":"Tori","cats":["place"],"diff":"easy"},
      {"en":"Restaurant","fi":"Ravintola","cats":["place","food"],"diff":"medium"},
      {"en":"Cinema","fi":"Elokuvateatteri","cats":["place"],"diff":"hard"},
      {"en":"Theater","fi":"Teatteri","cats":["place"],"diff":"medium"},
      {"en":"Hotel","fi":"Hotelli","cats":["place"],"diff":"easy"},
      {"en":"Bank","fi":"Pankki","cats":["place"],"diff":"easy"},
      {"en":"Post office","fi":"Posti","cats":["place"],"diff":"medium"},
      {"en":"Police station","fi":"Poliisilaitos","cats":["place"],"diff":"hard"},
      {"en":"Farm","fi":"Maatila","cats":["place","nature"],"diff":"easy"},
      {"en":"Temple","fi":"Temppeli","cats":["place"],"diff":"medium"},

      {"en":"River","fi":"Joki","cats":["nature"],"diff":"easy"},
      {"en":"Lake","fi":"J√§rvi","cats":["nature"],"diff":"easy"},
      {"en":"Ocean","fi":"Valtameri","cats":["nature"],"diff":"easy"},
      {"en":"Waterfall","fi":"Vesiputous","cats":["nature"],"diff":"medium"},
      {"en":"Volcano","fi":"Tulivuori","cats":["nature"],"diff":"medium"},
      {"en":"Glacier","fi":"J√§√§tikk√∂","cats":["nature"],"diff":"medium"},
      {"en":"Canyon","fi":"Kanjoni","cats":["nature"],"diff":"medium"},
      {"en":"Meadow","fi":"Niitty","cats":["nature"],"diff":"medium"},
      {"en":"Cave","fi":"Luola","cats":["nature","place"],"diff":"easy"},
      {"en":"Coral reef","fi":"Koralliriutta","cats":["nature"],"diff":"hard"},
      {"en":"Rainbow","fi":"Sateenkaari","cats":["nature"],"diff":"medium"},
      {"en":"Thunderstorm","fi":"Ukkosmyrsky","cats":["nature"],"diff":"hard"},
      {"en":"Hurricane","fi":"Hurrikaani","cats":["nature"],"diff":"hard"},
      {"en":"Tornado","fi":"Tornado","cats":["nature"],"diff":"medium"},
      {"en":"Earthquake","fi":"Maanj√§ristys","cats":["nature"],"diff":"hard"},
      {"en":"Fog","fi":"Sumu","cats":["nature"],"diff":"easy"},
      {"en":"Dew","fi":"Kaste","cats":["nature"],"diff":"easy"},
      {"en":"Pine tree","fi":"M√§nty","cats":["nature"],"diff":"medium"},
      {"en":"Oak","fi":"Tammi","cats":["nature"],"diff":"easy"},
      {"en":"Palm tree","fi":"Palmu","cats":["nature"],"diff":"medium"},
      {"en":"Sunflower","fi":"Auringonkukka","cats":["nature"],"diff":"hard"},
      {"en":"Rose","fi":"Ruusu","cats":["nature"],"diff":"easy"},
      {"en":"Snowflake","fi":"Lumihiutale","cats":["nature"],"diff":"hard"},
      {"en":"Pebble","fi":"Pikkukivi","cats":["nature","thing"],"diff":"medium"},

      {"en":"Camping","fi":"Telttailu","cats":["activity"],"diff":"medium"},
      {"en":"Hiking","fi":"Vaellus","cats":["activity","nature"],"diff":"medium"},
      {"en":"Swimming","fi":"Uinti","cats":["activity"],"diff":"easy"},
      {"en":"Dancing","fi":"Tanssi","cats":["activity"],"diff":"easy"},
      {"en":"Singing","fi":"Laulaminen","cats":["activity"],"diff":"medium"},
      {"en":"Painting","fi":"Maalaaminen","cats":["activity"],"diff":"medium"},
      {"en":"Reading","fi":"Lukeminen","cats":["activity"],"diff":"medium"},
      {"en":"Cooking","fi":"Ruoanlaitto","cats":["activity","food"],"diff":"medium"},
      {"en":"Fishing","fi":"Kalastus","cats":["activity","nature"],"diff":"medium"},
      {"en":"Skiing","fi":"Hiihto","cats":["activity"],"diff":"easy"},
      {"en":"Snowboarding","fi":"Lumilautailu","cats":["activity"],"diff":"hard"},
      {"en":"Surfing","fi":"Surffaus","cats":["activity"],"diff":"medium"},
      {"en":"Yoga","fi":"Jooga","cats":["activity"],"diff":"easy"},
      {"en":"Meditation","fi":"Meditaatio","cats":["activity"],"diff":"hard"},
      {"en":"Chess","fi":"Shakki","cats":["activity"],"diff":"easy"},
      {"en":"Board game","fi":"Lautapeli","cats":["activity"],"diff":"medium"},
      {"en":"Karaoke","fi":"Karaoke","cats":["activity"],"diff":"easy"},
      {"en":"Photography","fi":"Valokuvaus","cats":["activity"],"diff":"hard"},
      {"en":"Gardening","fi":"Puutarhanhoito","cats":["activity","nature"],"diff":"hard"},
      {"en":"Baking","fi":"Leivonta","cats":["activity","food"],"diff":"medium"},
      {"en":"Running","fi":"Juoksu","cats":["activity"],"diff":"easy"},
      {"en":"Cycling","fi":"Py√∂r√§ily","cats":["activity","vehicle"],"diff":"medium"},
      {"en":"Picnic","fi":"Piknik","cats":["activity","nature"],"diff":"medium"},
      {"en":"Shopping","fi":"Ostokset","cats":["activity"],"diff":"medium"},

      {"en":"Smartphone","fi":"√Ñlypuhelin","cats":["thing"],"diff":"hard"},
      {"en":"Laptop","fi":"Kannettava tietokone","cats":["thing"],"diff":"hard"},
      {"en":"Tablet","fi":"Tabletti","cats":["thing"],"diff":"medium"},
      {"en":"Headphones","fi":"Kuulokkeet","cats":["thing"],"diff":"hard"},
      {"en":"Microphone","fi":"Mikrofoni","cats":["thing"],"diff":"medium"},
      {"en":"Keyboard","fi":"N√§pp√§imist√∂","cats":["thing"],"diff":"hard"},
      {"en":"Mouse","fi":"Hiiri","cats":["thing"],"diff":"easy"},
      {"en":"Umbrella","fi":"Sateenvarjo","cats":["thing"],"diff":"medium"},
      {"en":"Wallet","fi":"Lompakko","cats":["thing"],"diff":"medium"},
      {"en":"Key","fi":"Avain","cats":["thing"],"diff":"easy"},
      {"en":"Watch","fi":"Kello","cats":["thing"],"diff":"easy"},
      {"en":"Glasses","fi":"Silm√§lasit","cats":["thing"],"diff":"hard"},
      {"en":"Toothbrush","fi":"Hammasharja","cats":["thing"],"diff":"hard"},
      {"en":"Candle","fi":"Kynttil√§","cats":["thing"],"diff":"medium"},
      {"en":"Mirror","fi":"Peili","cats":["thing"],"diff":"easy"},
      {"en":"Pillow","fi":"Tyyny","cats":["thing"],"diff":"easy"},
      {"en":"Blanket","fi":"Peitto","cats":["thing"],"diff":"medium"},
      {"en":"Hammer","fi":"Vasara","cats":["thing"],"diff":"easy"},
      {"en":"Screwdriver","fi":"Ruuvimeisseli","cats":["thing"],"diff":"hard"},
      {"en":"Rope","fi":"K√∂ysi","cats":["thing"],"diff":"easy"},
      {"en":"Flashlight","fi":"Taskulamppu","cats":["thing"],"diff":"hard"},
      {"en":"Battery","fi":"Paristo","cats":["thing"],"diff":"medium"},
      {"en":"Compass","fi":"Kompassi","cats":["thing"],"diff":"medium"},
      {"en":"Map","fi":"Kartta","cats":["thing","place"],"diff":"easy"},

      {"en":"Sisu","fi":"Sisu","cats":["thing","suomi"],"diff":"easy"},
      {"en":"Kalsarik√§nnit","fi":"Kalsarik√§nnit","cats":["activity","suomi"],"diff":"hard"},
      {"en":"Fazer Blue","fi":"Fazerin Sininen","cats":["food","suomi"],"diff":"medium"},
      {"en":"Kalakukko","fi":"Kalakukko","cats":["food","suomi"],"diff":"hard"},
      {"en":"Nokia","fi":"Nokia","cats":["thing","suomi"],"diff":"easy"},
      {"en":"Iittala","fi":"Iittala","cats":["thing","suomi"],"diff":"medium"},
      {"en":"Marimekko","fi":"Marimekko","cats":["thing","suomi"],"diff":"medium"},
      {"en":"Sibelius","fi":"Sibelius","cats":["person","suomi"],"diff":"medium"},
      {"en":"Aino Ackt√©","fi":"Aino Ackt√©","cats":["person","suomi"],"diff":"hard"},
      {"en":"K√§√§rij√§","fi":"K√§√§rij√§","cats":["person","suomi"],"diff":"medium"},
      {"en":"Cheek","fi":"Cheek","cats":["person","suomi"],"diff":"easy"},
      {"en":"Teemu Sel√§nne","fi":"Teemu Sel√§nne","cats":["person","suomi"],"diff":"hard"},
      {"en":"Porvoo","fi":"Porvoo","cats":["place","suomi"],"diff":"medium"},
      {"en":"Savonlinna","fi":"Savonlinna","cats":["place","suomi"],"diff":"medium"},
      {"en":"Koli National Park","fi":"Kolin kansallispuisto","cats":["place","nature","suomi"],"diff":"hard"},
      {"en":"Nuuksio","fi":"Nuuksio","cats":["place","nature","suomi"],"diff":"medium"},
      {"en":"Linnanm√§ki","fi":"Linnanm√§ki","cats":["place","activity","suomi"],"diff":"medium"},
      {"en":"Ice fishing","fi":"Pilkkiminen","cats":["activity","suomi"],"diff":"medium"},
      {"en":"Cottage","fi":"M√∂kki","cats":["place","suomi"],"diff":"easy"},
      {"en":"Ruisrock","fi":"Ruisrock","cats":["activity","suomi"],"diff":"medium"},
      {"en":"Provinssi","fi":"Provinssi","cats":["activity","suomi"],"diff":"medium"},
      {"en":"Ski holiday","fi":"Hiihtoloma","cats":["activity","suomi"],"diff":"medium"},
      {"en":"Reindeer corral","fi":"Poroaitaus","cats":["place","animal","suomi"],"diff":"hard"},
      {"en":"Cloudberry","fi":"Lakka","cats":["food","nature","suomi"],"diff":"medium"},

      {"en":"Inception","fi":"Inception","cats":["movies"],"diff":"medium"},
      {"en":"The Matrix","fi":"Matrix","cats":["movies","space"],"diff":"medium"},
      {"en":"Titanic","fi":"Titanic","cats":["movies"],"diff":"easy"},
      {"en":"Star Wars","fi":"T√§htien sota","cats":["movies","space"],"diff":"easy"},
      {"en":"The Lord of the Rings","fi":"Taru sormusten herrasta","cats":["movies"],"diff":"hard"},
      {"en":"Harry Potter","fi":"Harry Potter","cats":["movies"],"diff":"easy"},
      {"en":"Jurassic Park","fi":"Jurassic Park","cats":["movies","animal"],"diff":"medium"},
      {"en":"Avatar","fi":"Avatar","cats":["movies","space"],"diff":"easy"},
      {"en":"The Godfather","fi":"Kummiset√§","cats":["movies"],"diff":"hard"},
      {"en":"Forrest Gump","fi":"Forrest Gump","cats":["movies"],"diff":"medium"},
      {"en":"The Lion King","fi":"Leijonakuningas","cats":["movies","animal"],"diff":"medium"},
      {"en":"Frozen","fi":"Frozen","cats":["movies"],"diff":"easy"},
      {"en":"Toy Story","fi":"Toy Story","cats":["movies"],"diff":"easy"},
      {"en":"Spider-Man","fi":"H√§m√§h√§kkimies","cats":["movies"],"diff":"easy"},
      {"en":"Batman","fi":"Batman","cats":["movies"],"diff":"easy"},
      {"en":"The Avengers","fi":"Avengers","cats":["movies"],"diff":"medium"},
      {"en":"Interstellar","fi":"Interstellar","cats":["movies","space"],"diff":"hard"},
      {"en":"Back to the Future","fi":"Paluu tulevaisuuteen","cats":["movies"],"diff":"hard"},
      {"en":"Home Alone","fi":"Yksin kotona","cats":["movies"],"diff":"easy"},
      {"en":"Jaws","fi":"Tappajahai","cats":["movies","animal"],"diff":"medium"},
      {"en":"The Shining","fi":"Hohto","cats":["movies"],"diff":"hard"},
      {"en":"Gladiator","fi":"Gladiator","cats":["movies"],"diff":"medium"},
      {"en":"Rocky","fi":"Rocky","cats":["movies","activity"],"diff":"easy"},
      {"en":"The Terminator","fi":"Terminator","cats":["movies"],"diff":"medium"},
      {"en":"Finding Nemo","fi":"Nemoa etsim√§ss√§","cats":["movies","animal"],"diff":"medium"},
      {"en":"Coco","fi":"Coco","cats":["movies","music"],"diff":"easy"},
      {"en":"La La Land","fi":"La La Land","cats":["movies","music"],"diff":"medium"},
      {"en":"The Sound of Music","fi":"Sound of Music","cats":["movies","music"],"diff":"hard"},
      {"en":"Pirates of the Caribbean","fi":"Pirates of the Caribbean","cats":["movies","vehicle"],"diff":"hard"},
      {"en":"Mission: Impossible","fi":"Mission: Impossible","cats":["movies"],"diff":"hard"},

      {"en":"Guitar","fi":"Kitara","cats":["music","thing"],"diff":"easy"},
      {"en":"Piano","fi":"Piano","cats":["music","thing"],"diff":"easy"},
      {"en":"Drums","fi":"Rummut","cats":["music","thing"],"diff":"easy"},
      {"en":"Violin","fi":"Viulu","cats":["music","thing"],"diff":"medium"},
      {"en":"Saxophone","fi":"Saksofoni","cats":["music","thing"],"diff":"hard"},
      {"en":"Microphone","fi":"Mikrofoni","cats":["music","thing"],"diff":"medium"},
      {"en":"DJ","fi":"DJ","cats":["music","person"],"diff":"easy"},
      {"en":"Band","fi":"B√§ndi","cats":["music","person"],"diff":"easy"},
      {"en":"Choir","fi":"Kuoro","cats":["music","activity"],"diff":"medium"},
      {"en":"Orchestra","fi":"Orkesteri","cats":["music","person"],"diff":"medium"},
      {"en":"Concert","fi":"Keikka","cats":["music","activity"],"diff":"easy"},
      {"en":"Festival","fi":"Festari","cats":["music","activity"],"diff":"easy"},
      {"en":"Playlist","fi":"Soittolista","cats":["music","thing"],"diff":"medium"},
      {"en":"Headphones","fi":"Kuulokkeet","cats":["music","thing"],"diff":"hard"},
      {"en":"Vinyl record","fi":"Vinyylilevy","cats":["music","thing"],"diff":"hard"},
      {"en":"Songwriter","fi":"S√§velt√§j√§","cats":["music","person"],"diff":"hard"},
      {"en":"Rap","fi":"Rap","cats":["music"],"diff":"easy"},
      {"en":"Rock","fi":"Rock","cats":["music"],"diff":"easy"},
      {"en":"Jazz","fi":"Jazz","cats":["music"],"diff":"easy"},
      {"en":"Classical music","fi":"Klassinen musiikki","cats":["music"],"diff":"hard"},
      {"en":"Pop music","fi":"Popmusiikki","cats":["music"],"diff":"medium"},
      {"en":"Heavy metal","fi":"Heavy metal","cats":["music"],"diff":"medium"},
      {"en":"Karaoke","fi":"Karaoke","cats":["music","activity"],"diff":"easy"},
      {"en":"Encore","fi":"Ylim√§√§r√§inen","cats":["music"],"diff":"hard"},
      {"en":"Stage","fi":"Lava","cats":["music","place"],"diff":"easy"},
      {"en":"Amplifier","fi":"Vahvistin","cats":["music","thing"],"diff":"medium"},
      {"en":"Metronome","fi":"Metronomi","cats":["music","thing"],"diff":"hard"},
      {"en":"Sheet music","fi":"Nuotit","cats":["music","thing"],"diff":"medium"},
      {"en":"Opera","fi":"Ooppera","cats":["music","place"],"diff":"medium"},
      {"en":"Ballet","fi":"Baletti","cats":["music","activity"],"diff":"medium"},

      {"en":"Nightwish","fi":"Nightwish","cats":["music","person","suomi"],"diff":"medium"},
      {"en":"The Rasmus","fi":"The Rasmus","cats":["music","person","suomi"],"diff":"medium"},
      {"en":"HIM","fi":"HIM","cats":["music","person","suomi"],"diff":"easy"},
      {"en":"Apocalyptica","fi":"Apocalyptica","cats":["music","person","suomi"],"diff":"hard"},
      {"en":"ALMA","fi":"ALMA","cats":["music","person","suomi"],"diff":"easy"},
      {"en":"Erika Vikman","fi":"Erika Vikman","cats":["music","person","suomi"],"diff":"hard"},
      {"en":"JVG","fi":"JVG","cats":["music","person","suomi"],"diff":"easy"},
      {"en":"Haloo Helsinki!","fi":"Haloo Helsinki!","cats":["music","person","suomi"],"diff":"hard"},
      {"en":"Ultra Bra","fi":"Ultra Bra","cats":["music","person","suomi"],"diff":"medium"},
      {"en":"Kaija Koo","fi":"Kaija Koo","cats":["music","person","suomi"],"diff":"medium"},
      {"en":"Vain el√§m√§√§","fi":"Vain el√§m√§√§","cats":["music","activity","suomi"],"diff":"hard"},
      {"en":"Tangomarkkinat","fi":"Tangomarkkinat","cats":["music","activity","suomi"],"diff":"hard"},
      {"en":"Savonlinna Opera Festival","fi":"Savonlinnan oopperajuhlat","cats":["music","activity","place","suomi"],"diff":"hard"},

      {"en":"Uuno Turhapuro","fi":"Uuno Turhapuro","cats":["movies","person","suomi"],"diff":"hard"},
      {"en":"The Unknown Soldier","fi":"Tuntematon sotilas","cats":["movies","suomi"],"diff":"hard"},
      {"en":"Napapiirin sankarit","fi":"Napapiirin sankarit","cats":["movies","suomi"],"diff":"hard"},
      {"en":"Rare Exports","fi":"Rare Exports","cats":["movies","suomi"],"diff":"medium"},
      {"en":"Aki Kaurism√§ki","fi":"Aki Kaurism√§ki","cats":["movies","person","suomi"],"diff":"hard"},
      {"en":"Klaus H√§r√∂","fi":"Klaus H√§r√∂","cats":["movies","person","suomi"],"diff":"hard"},
      {"en":"Finnish Film Foundation","fi":"Suomen elokuvas√§√§ti√∂","cats":["movies","thing","suomi"],"diff":"hard"},
      {"en":"Helsinki International Film Festival","fi":"Rakkautta & Anarkiaa","cats":["movies","activity","place","suomi"],"diff":"hard"},
      {"en":"Cinema Orion","fi":"Elokuvateatteri Orion","cats":["movies","place","suomi"],"diff":"hard"},

      {"en":"Kinojuha","fi":"Kinojuha","cats":["kinojuha","place","suomi"],"diff":"easy"},
      {"en":"Taavi Vartia","fi":"Taavi Vartia","cats":["kinojuha","movies","person","suomi"],"diff":"hard"},
      {"en":"Nurmij√§rvi","fi":"Nurmij√§rvi","cats":["kinojuha","place","suomi"],"diff":"easy"},
      {"en":"Taaborin Kes√§teatteri","fi":"Taaborin Kes√§teatteri","cats":["kinojuha","movies","activity","place","suomi"],"diff":"hard"},
      {"en":"Taaborinvuori","fi":"Taaborinvuori","cats":["kinojuha","place","nature","suomi"],"diff":"hard"},
      {"en":"Art House screening","fi":"Art House -n√§yt√∂s","cats":["kinojuha","movies","activity","suomi"],"diff":"medium"},
      {"en":"Premiere night","fi":"Ensi-ilta","cats":["kinojuha","movies","activity"],"diff":"medium"},
      {"en":"Movie ticket","fi":"Elokuvalippu","cats":["kinojuha","movies","thing"],"diff":"easy"},
      {"en":"VIP hall","fi":"VIP-sali","cats":["kinojuha","movies","place"],"diff":"medium"},
      {"en":"50s interior","fi":"50-luvun tunnelma","cats":["kinojuha","thing","suomi"],"diff":"hard"},
      {"en":"Popcorn combo","fi":"Popparikombo","cats":["kinojuha","food"],"diff":"easy"},

      {"en":"R√∂lli ja kultainen avain","fi":"R√∂lli ja kultainen avain","cats":["kinojuha","movies","suomi"],"diff":"hard"},
      {"en":"R√∂lli ja kaikkien aikojen salaisuus","fi":"R√∂lli ja kaikkien aikojen salaisuus","cats":["kinojuha","movies","suomi"],"diff":"hard"},
      {"en":"The Island of Secrets","fi":"Lomasankarit","cats":["kinojuha","movies","suomi"],"diff":"hard"},
      {"en":"Finders of the Lost Yacht","fi":"Pertsa ja Kilu","cats":["kinojuha","movies","suomi"],"diff":"hard"},
      {"en":"World's Safest Place","fi":"Kevytt√§ yl√§pilve√§","cats":["kinojuha","movies","suomi"],"diff":"hard"},

      {"en":"Pahat pojat","fi":"Pahat pojat","cats":["kinojuha","movies","suomi"],"diff":"medium"},
      {"en":"Leijonasyd√§n","fi":"Leijonasyd√§n","cats":["kinojuha","movies","suomi"],"diff":"hard"},
      {"en":"H√§jyt","fi":"H√§jyt","cats":["kinojuha","movies","suomi"],"diff":"medium"},
      {"en":"Kopps","fi":"Kopps","cats":["kinojuha","movies","suomi"],"diff":"easy"},
      {"en":"Luokkakokous","fi":"Luokkakokous","cats":["kinojuha","movies","suomi"],"diff":"medium"},
      {"en":"Napapiirin sankarit","fi":"Napapiirin sankarit","cats":["kinojuha","movies","suomi"],"diff":"hard"},
      {"en":"Rare Exports","fi":"Rare Exports","cats":["kinojuha","movies","suomi"],"diff":"medium"},
      {"en":"Tuntematon sotilas","fi":"Tuntematon sotilas","cats":["kinojuha","movies","suomi"],"diff":"hard"},
      {"en":"Uuno Turhapuro","fi":"Uuno Turhapuro","cats":["kinojuha","movies","person","suomi"],"diff":"hard"},

      {"en":"Jasper P√§√§kk√∂nen","fi":"Jasper P√§√§kk√∂nen","cats":["kinojuha","movies","person","suomi"],"diff":"hard"},
      {"en":"Laura Birn","fi":"Laura Birn","cats":["kinojuha","movies","person","suomi"],"diff":"hard"},
      {"en":"Krista Kosonen","fi":"Krista Kosonen","cats":["kinojuha","movies","person","suomi"],"diff":"hard"},
      {"en":"Jussi Vatanen","fi":"Jussi Vatanen","cats":["kinojuha","movies","person","suomi"],"diff":"hard"},
      {"en":"Kari V√§√§n√§nen","fi":"Kari V√§√§n√§nen","cats":["kinojuha","movies","person","suomi"],"diff":"hard"},
      {"en":"Peter Franz√©n","fi":"Peter Franz√©n","cats":["kinojuha","movies","person","suomi"],"diff":"hard"},
      {"en":"Vesa-Matti Loiri","fi":"Vesa-Matti Loiri","cats":["kinojuha","movies","person","suomi"],"diff":"hard"},
      {"en":"Eero Aho","fi":"Eero Aho","cats":["kinojuha","movies","person","suomi"],"diff":"hard"},
      {"en":"Pirjo Lonka","fi":"Pirjo Lonka","cats":["kinojuha","movies","person","suomi"],"diff":"hard"},
      {"en":"Irina Bj√∂rklund","fi":"Irina Bj√∂rklund","cats":["kinojuha","movies","person","suomi"],"diff":"hard"}
    ]
  }
  </script>

  <script>
    "use strict";

    // ---- Storage keys (localStorage) ----
    const LS = {
      lang: "wi_lang",
      selftest: "wi_selftest",
      players: "wi_players",
      playersMode: "wi_players_mode", // "preset" | "custom"
      hint: "wi_hint",
      hidden: "wi_hidden",
      difficulty: "wi_difficulty", // all|easy|medium|hard
      categories: "wi_categories", // comma-separated keys; empty = all
      lastSecret: "wi_last_secret" // last picked secret (to reduce immediate repeats)
    };

    const storage = {
      get(key, fallback=null){
        try{
          const v = localStorage.getItem(key);
          return v === null ? fallback : v;
        }catch(_e){
          return fallback;
        }
      },
      set(key, value){
        try{ localStorage.setItem(key, String(value)); }catch(_e){}
      },
      getBool(key, fallback=false){
        const v = this.get(key, null);
        if(v === null) return fallback;
        return v === "1" || v === "true";
      },
      setBool(key, value){
        this.set(key, value ? "1" : "0");
      }
    };

    const $ = (id) => document.getElementById(id);

    const CATEGORY_KEYS = ["space","food","animal","person","vehicle","place","nature","activity","thing","movies","music","kinojuha","suomi"]; // keep in sync with i18n // keep in sync with i18n // keep in sync with i18n
    const DIFF_KEYS = ["all","easy","medium","hard"];

    function inferDifficultyFromText(en, fi){
      const a = String(en || "").trim();
      const b = String(fi || "").trim();
      const maxLen = Math.max(a.length, b.length);
      const hasSpace = a.includes(" ") || b.includes(" ");
      if(maxLen >= 13) return "hard";
      if(hasSpace || maxLen >= 8) return "medium";
      return "easy";
    }

    function normalizeWord(raw){
      if(!raw) return null;
      const en = String(raw.en || "").trim();
      const fi = String(raw.fi || "").trim();
      if(!en || !fi) return null;

      const cats = Array.isArray(raw.cats) ? raw.cats.map(String).map(s => s.trim()).filter(Boolean) : [];
      const safeCats = cats.length ? cats : ["thing"];
      const diff = DIFF_KEYS.includes(raw.diff) ? raw.diff : inferDifficultyFromText(en, fi);

      return { en, fi, cats: safeCats, diff };
    }

    function loadWordBank(){
      const node = $("wordData");
      if(!node) return [];
      try{
        const parsed = JSON.parse(node.textContent || "{}");
        const words = Array.isArray(parsed.words) ? parsed.words : [];
        const out = [];
        for(const w of words){
          const n = normalizeWord(w);
          if(n) out.push(n);
        }
        return out;
      }catch(e){
        console.error("Failed to parse wordData JSON", e);
        return [];
      }
    }

    const WORD_BANK = loadWordBank();

    const I18N = {
      en: {
        title: "Sanahuijari.fi",
        tagline: "Pass & play on one device",

        players: "Number of players",
        custom: "Custom",
        difficulty: "Difficulty level",
        categories: "Word categories",
        all: "All",
        diff_easy: "Easy",
        diff_medium: "Medium",
        diff_hard: "Hard",
        impostorHint: "Impostor: Word category hint",
        toggle_on: "On",
        toggle_off: "Off",
        hiddenImpostor: "Impostor: Gets a wrong word",
        start: "Start",
        reveal: "Reveal the card",
        close: "Close & Pass to the next player",
        doneTitle: "Start playing",
        doneBody: "All players have seen their cards.",
        newGame: "New game",
        youAreImpostor: "You are an impostor",
        card_word: "WORD",
        category: "CATEGORY",
        categoriesLabel: "CATEGORIES",
        alertNoWords: "No words match your filters.",
        player: (n) => `Player ${n}`,
        cat_space: "Space",
        cat_food: "Food",
        cat_animal: "Animal",
        cat_person: "Person",
        cat_vehicle: "Vehicle",
        cat_place: "Place",
        cat_nature: "Nature",
        cat_activity: "Activity",
        cat_thing: "Thing",
        cat_suomi: "Finland",
        cat_movies: "Movies",
        cat_music: "Music",
        cat_kinojuha: "Kinojuha",
        footerTop: "sanahuijari.fi ¬∑ v1.51",
        footerBottom: "Made by AI with ‚ù§Ô∏è ‚Äî 0% human code.",
        footer: "Made by AI with ‚ù§Ô∏è ‚Äî 0% human code. ¬∑ sanahuijari.fi ¬∑ v1.511",
        meta_desc: "Pass-and-play word impostor game for one phone/tablet.",
        meta_short: "Sanahuijari",

        selfTest: "Self-test",
        testsPassed: "Self-test: all good ‚úÖ",
        testsFailed: (n) => `Self-test: ${n} issue(s) ‚Äî check console ‚ö†Ô∏è`,
        testsOn: "Self-test ON",
        testsOff: "Self-test OFF",
        repo: "GitHub repository",

      },
      fi: {
        title: "Sanahuijari.fi",
        tagline: "Pelaa liven√§ yhdell√§ laitteella",

        players: "Pelaajien m√§√§r√§",
        custom: "Muu",
        difficulty: "Vaikeustaso",
        categories: "Sanaluokat",
        all: "Kaikki",
        diff_easy: "Helppo",
        diff_medium: "Keskitaso",
        diff_hard: "Vaikea",
        impostorHint: "Huijari: Luokkavihje",
        toggle_on: "P√§√§ll√§",
        toggle_off: "Pois",
        hiddenImpostor: "Huijari: Saa v√§√§r√§n sanan",
        start: "Aloita",
        reveal: "N√§yt√§ kortti",
        close: "Sulje & Anna seuraavalle pelaajalle",
        doneTitle: "Aloittakaa peli",
        doneBody: "Kaikki ovat n√§hneet korttinsa.",
        newGame: "Uusi peli",
        youAreImpostor: "Olet huijari",
        card_word: "SANA",
        category: "LUOKKA",
        categoriesLabel: "LUOKAT",
        alertNoWords: "Yht√§√§n sanaa ei l√∂ydy valinnoilla.",
        player: (n) => `Pelaaja ${n}`,
        cat_space: "Avaruus",
        cat_food: "Ruoka",
        cat_animal: "El√§in",
        cat_person: "Henkil√∂",
        cat_vehicle: "Ajoneuvo",
        cat_place: "Paikka",
        cat_nature: "Luonto",
        cat_activity: "Toiminta",
        cat_thing: "Asia",
        cat_suomi: "Suomi",
        cat_movies: "Elokuvat",
        cat_music: "Musiikki",
        cat_kinojuha: "Kinojuha",
        footerTop: "sanahuijari.fi ¬∑ v1.51",
        footerBottom: "Teko√§lyn tekem√§ ‚ù§Ô∏è ‚Äî 0 % ihmiskoodia.",
        footer: "Teko√§lyn tekem√§ ‚ù§Ô∏è ‚Äî 0 % ihmiskoodia. ¬∑ sanahuijari.fi ¬∑ v1.511",
        meta_desc: "Sanahuijari yhdell√§ puhelimella/tabletilla ‚Äî pelaa liven√§.",
        meta_short: "Sanahuijari",

        selfTest: "Itsetesti",
        testsPassed: "Itsetesti: kaikki ok ‚úÖ",
        testsFailed: (n) => `Itsetesti: ${n} ongelmaa ‚Äî katso konsoli ‚ö†Ô∏è`,
        testsOn: "Itsetesti P√Ñ√ÑLL√Ñ",
        testsOff: "Itsetesti POIS",
        repo: "GitHub-repositorio",

      }
    };

    const state = {
      lang: "fi",
      totalPlayers: 0,
      currentPlayer: 1,
      impostorPlayer: 0,
      secret: null,
      decoy: null,
      pool: [],
      dealing: false,
      impostorHintEnabled: false,
      hiddenImpostorEnabled: false,
      difficulty: "all",
      selectedCats: [], // empty = all
      deckKey: "",
      deck: [],
    };

    // Cache DOM references
    const el = {
      html: document.documentElement,

      titleText: $("titleText"),
      taglineText: $("taglineText"),

      playersLabel: $("playersLabel"),
      customBtn: $("customBtn"),
      difficultyLabel: $("difficultyLabel"),
      categoriesLabel: $("categoriesLabel"),
      difficultySeg: $("difficultySeg"),
      categoryChips: $("categoryChips"),

      impostorHintName: $("impostorHintName"),
      hiddenImpostorName: $("hiddenImpostorName"),
      doneText: $("doneText"),
      doneSub: $("doneSub"),

      langEn: $("langEn"),
      langFi: $("langFi"),

      setupPanel: $("setupPanel"),
      dealPanel: $("dealPanel"),
      donePanel: $("donePanel"),

      playerQuick: $("playerQuick"),
      playersInput: $("playersInput"),
      impostorHintToggle: $("impostorHintToggle"),
      hiddenImpostorToggle: $("hiddenImpostorToggle"),
      impostorHintState: $("impostorHintState"),
      hiddenImpostorState: $("hiddenImpostorState"),

      startBtn: $("startBtn"),

      playerHeading: $("playerHeading"),
      progressText: $("progressText"),

      faceDown: $("faceDown"),
      faceUp: $("faceUp"),
      revealBtn: $("revealBtn"),
      closeCardBtn: $("closeCardBtn"),

      cardLabel: $("cardLabel"),
      cardMain: $("cardMain"),

      impostorHintBox: $("impostorHintBox"),
      impostorHintLabel: $("impostorHintLabel"),
      impostorHintText: $("impostorHintText"),

      newGameBtn: $("newGameBtn"),

      diffAll: $("diffAll"),
      diffEasy: $("diffEasy"),
      diffMedium: $("diffMedium"),
      diffHard: $("diffHard"),

      footerTop: $("footerTop"),
      footerBottom: $("footerBottom"),
      selfTestBtn: $("selfTestBtn"),
      repoBtn: $("repoBtn"),
      toast: $("toast"),
    };

    function ensureArrays(){
      if(!Array.isArray(state.selectedCats)) state.selectedCats = [];
      if(!Array.isArray(state.pool)) state.pool = [];
      if(!Array.isArray(state.deck)) state.deck = [];
    }

    function t(key, ...args){
      const dict = I18N[state.lang] || I18N.en;
      const v = dict[key];
      if(typeof v === "function") return v(...args);
      if(v == null) return key;
      return v;
    }

    function iconSvg(){
      // Finnish-first icon: "S" + ".fi". Works as favicon + manifest icon.
      // Note: iOS home-screen icon via data-URI is best-effort.
      return `<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
  <defs>
    <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="#7aa7ff"/>
      <stop offset="1" stop-color="#0b1020"/>
    </linearGradient>
  </defs>
  <rect width="512" height="512" rx="120" fill="url(#g)"/>
  <circle cx="256" cy="256" r="152" fill="rgba(255,255,255,0.10)" stroke="rgba(255,255,255,0.22)" stroke-width="10"/>
  <text x="50%" y="56%" text-anchor="middle" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial" font-size="210" font-weight="1000" fill="#08102a">S</text>
  <text x="50%" y="73%" text-anchor="middle" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial" font-size="92" font-weight="950" fill="#08102a">.fi</text>
  <path d="M408 150l20 40 44 6-32 31 8 44-40-21-40 21 8-44-32-31 44-6z" fill="rgba(255,255,255,0.35)"/>
</svg>`;
    }

    function dataUriSvg(svg){
      return "data:image/svg+xml," + encodeURIComponent(svg)
        .replace(/%0A/g, "")
        .replace(/%20/g, " ");
    }

    function applyAppMetaAndManifest(){
      // Meta
      const desc = t("meta_desc");
      const title = t("title");

      const descMeta = document.getElementById("descMeta");
      if(descMeta) descMeta.setAttribute("content", desc);

      const appNameMeta = document.getElementById("appNameMeta");
      if(appNameMeta) appNameMeta.setAttribute("content", title);

      const appleTitleMeta = document.getElementById("appleTitleMeta");
      if(appleTitleMeta) appleTitleMeta.setAttribute("content", title);

      const ogTitleMeta = document.getElementById("ogTitleMeta");
      if(ogTitleMeta) ogTitleMeta.setAttribute("content", title);

      const ogDescMeta = document.getElementById("ogDescMeta");
      if(ogDescMeta) ogDescMeta.setAttribute("content", desc);

      // Icons
      const svg = iconSvg();
      const iconHref = dataUriSvg(svg);
      const icon = document.getElementById("appIcon");
      const appleIcon = document.getElementById("appleIcon");
      const maskIcon = document.getElementById("maskIcon");
      if(icon) icon.setAttribute("href", iconHref);
      if(appleIcon) appleIcon.setAttribute("href", iconHref);
      if(maskIcon) maskIcon.setAttribute("href", iconHref);

      // Manifest (single-file): generated as a blob URL so we don't need a separate manifest.json.
      const manifest = {
        name: title,
        short_name: t("meta_short"),
        start_url: "./",
        scope: "./",
        display: "standalone",
        background_color: "#0b1020",
        theme_color: "#0b1020",
        icons: [
          {
            src: iconHref,
            sizes: "any",
            type: "image/svg+xml",
            purpose: "any maskable"
          }
        ]
      };

      const link = document.getElementById("manifestLink");
      if(link){
        try{
          if(applyAppMetaAndManifest._url) URL.revokeObjectURL(applyAppMetaAndManifest._url);
        }catch(_e){}
        const blob = new Blob([JSON.stringify(manifest)], { type: "application/manifest+json" });
        const url = URL.createObjectURL(blob);
        applyAppMetaAndManifest._url = url;
        link.setAttribute("href", url);
      }
    }

    function detectInitialLanguage(){
      const saved = storage.get(LS.lang, null);
      if(saved === "fi" || saved === "en") return saved;
      // Default to Finnish (device/browser language is ignored unless user explicitly switches).
      return "fi";
    }

    function updateToggleStateLabels(){
      const onText = t("toggle_on");
      const offText = t("toggle_off");
      if(el.impostorHintState && el.impostorHintToggle){
        el.impostorHintState.textContent = el.impostorHintToggle.checked ? onText : offText;
      }
      if(el.hiddenImpostorState && el.hiddenImpostorToggle){
        el.hiddenImpostorState.textContent = el.hiddenImpostorToggle.checked ? onText : offText;
      }
    }

    function setLanguage(lang){
      state.lang = (lang === "fi") ? "fi" : "en";
      storage.set(LS.lang, state.lang);

      // Defensive: el.html should always exist, but guard anyway.
      if(el.html) el.html.lang = state.lang;

      el.langEn?.classList.toggle("active", state.lang === "en");
      el.langFi?.classList.toggle("active", state.lang === "fi");

      if(el.titleText) el.titleText.textContent = t("title");
      if(el.taglineText) el.taglineText.textContent = t("tagline");
      document.title = t("title");
      applyAppMetaAndManifest();

      if(el.playersLabel) el.playersLabel.textContent = t("players");
      if(el.customBtn) el.customBtn.textContent = t("custom");

      if(el.difficultyLabel) el.difficultyLabel.textContent = t("difficulty");
      if(el.categoriesLabel) el.categoriesLabel.textContent = t("categories");

      if(el.diffAll) el.diffAll.textContent = t("all");
      if(el.diffEasy) el.diffEasy.textContent = t("diff_easy");
      if(el.diffMedium) el.diffMedium.textContent = t("diff_medium");
      if(el.diffHard) el.diffHard.textContent = t("diff_hard");

      if(el.impostorHintName) el.impostorHintName.textContent = t("impostorHint");
      if(el.hiddenImpostorName) el.hiddenImpostorName.textContent = t("hiddenImpostor");
      if(el.startBtn) el.startBtn.textContent = t("start");
      if(el.revealBtn) el.revealBtn.textContent = t("reveal");
      if(el.closeCardBtn) el.closeCardBtn.textContent = t("close");
      if(el.cardLabel) el.cardLabel.textContent = t("card_word");
      if(el.doneText) el.doneText.textContent = t("doneTitle");
      if(el.doneSub) el.doneSub.textContent = t("doneBody");
      if(el.newGameBtn) el.newGameBtn.textContent = t("newGame");
      if(el.footerTop) el.footerTop.textContent = t("footerTop");
      if(el.footerBottom) el.footerBottom.textContent = t("footerBottom");
      if(el.selfTestBtn){
        el.selfTestBtn.setAttribute("aria-label", t("selfTest"));
        el.selfTestBtn.title = t("selfTest");
      }
      if(el.repoBtn){
        el.repoBtn.setAttribute("aria-label", t("repo"));
        el.repoBtn.title = t("repo");
      }

      updateToggleStateLabels();
      renderCategoryChips();

      if(el.dealPanel && !el.dealPanel.classList.contains("hidden")){
        updateDealUI();
        if(el.faceUp && !el.faceUp.classList.contains("hidden")) revealCard(true);
      }
    }

    function randInt(min, maxInclusive){
      const range = (maxInclusive - min + 1);
      if(range <= 1) return min;

      const c = (globalThis.crypto && globalThis.crypto.getRandomValues) ? globalThis.crypto : null;
      if(c){
        const max = 0xFFFFFFFF;
        const limit = max - ((max + 1) % range);
        const buf = new Uint32Array(1);
        let x = 0;
        do{
          c.getRandomValues(buf);
          x = buf[0];
        }while(x > limit);
        return min + (x % range);
      }

      return min + Math.floor(Math.random() * range);
    }

    function shuffleInPlace(arr){
      for(let i = arr.length - 1; i > 0; i--){
        const j = randInt(0, i);
        const tmp = arr[i];
        arr[i] = arr[j];
        arr[j] = tmp;
      }
      return arr;
    }

    function currentPoolKey(){
      ensureArrays();
      const cats = state.selectedCats.length ? state.selectedCats.slice().sort().join(".") : "__all__";
      return `${state.difficulty}|${cats}`;
    }

    function ensureDeckForPool(pool){
      ensureArrays();
      const key = currentPoolKey();
      if(state.deckKey !== key || state.deck.length === 0){
        state.deckKey = key;
        state.deck = pool.slice();
        shuffleInPlace(state.deck);
      }
    }

    function showPanel(which){
      el.setupPanel?.classList.toggle("hidden", which !== "setup");
      el.dealPanel?.classList.toggle("hidden", which !== "deal");
      el.donePanel?.classList.toggle("hidden", which !== "done");
    }

    function updateDealUI(){
      el.playerHeading && (el.playerHeading.textContent = t("player", state.currentPlayer));
      el.progressText && (el.progressText.textContent = `${state.currentPlayer} / ${state.totalPlayers}`);
      el.faceDown?.classList.remove("hidden");
      el.faceUp?.classList.add("hidden");
      if(el.cardLabel) el.cardLabel.textContent = t("card_word");
    }

    function normalizeCats(entry){
      const cats = entry?.cats;
      return Array.isArray(cats) && cats.length ? cats : ["thing"];
    }

    function getHintCategories(word){
      const cats = normalizeCats(word);
      const uniq = Array.from(new Set(cats));
      uniq.sort((a,b) => {
        const ia = CATEGORY_KEYS.indexOf(a);
        const ib = CATEGORY_KEYS.indexOf(b);
        if(ia === -1 && ib === -1) return String(a).localeCompare(String(b));
        if(ia === -1) return 1;
        if(ib === -1) return -1;
        return ia - ib;
      });
      return uniq;
    }

    function categoryText(keys){
      return keys
        .map(k => (I18N[state.lang][`cat_${k}`] ?? I18N.en[`cat_${k}`] ?? k))
        .join(" / ");
    }

    function intersectsCats(a=[], b=[]){
      for(const x of a){
        if(b.includes(x)) return true;
      }
      return false;
    }

    function buildPool(){
      ensureArrays();
      let pool = WORD_BANK.slice();
      if(state.difficulty !== "all"){
        pool = pool.filter(w => w.diff === state.difficulty);
      }
      if(state.selectedCats.length){
        const set = new Set(state.selectedCats);
        pool = pool.filter(w => normalizeCats(w).some(c => set.has(c)));
      }
      return pool;
    }

    function chooseSecret(){
      ensureArrays();
      const pool = (state.pool && state.pool.length) ? state.pool : WORD_BANK;
      if(!pool.length){
        state.secret = null;
        return;
      }

      ensureDeckForPool(pool);

      let pick = state.deck.pop() || null;

      const last = storage.get(LS.lastSecret, "");
      if(pick && last && pick.en === last && state.deck.length){
        state.deck.unshift(pick);
        pick = state.deck.pop() || pick;
      }

      state.secret = pick;
      storage.set(LS.lastSecret, state.secret?.en || "");
    }

    function chooseDecoyForSecret(secret){
      if(!secret) return null;
      const cats = getHintCategories(secret);
      const basePool = state.pool && state.pool.length ? state.pool : WORD_BANK;
      const withoutSecret = basePool.filter(w => w !== secret);

      const sameDiff = withoutSecret.filter(w => w.diff === secret.diff);
      const strong = sameDiff.filter(w => intersectsCats(normalizeCats(w), cats));
      const weak = withoutSecret.filter(w => intersectsCats(normalizeCats(w), cats));

      const pool = strong.length ? strong : (weak.length ? weak : withoutSecret);
      return pool.length ? pool[randInt(0, pool.length - 1)] : null;
    }

    function clampPlayers(v){
      const n = Math.floor(Number(v));
      return Number.isFinite(n) ? Math.max(3, n) : 3;
    }

    function setActiveQuick(value){
      const btns = el.playerQuick?.querySelectorAll(".quickbtn") || [];
      btns.forEach(b => b.classList.toggle("active", b.dataset.count === String(value)));
    }

    function usePresetCount(n){
      if(!el.playersInput) return;
      el.playersInput.value = String(n);
      el.playersInput.classList.add("hidden");
      setActiveQuick(String(n));
      storage.set(LS.playersMode, "preset");
      storage.set(LS.players, n);
    }

    function useCustomCount(){
      if(!el.playersInput) return;
      setActiveQuick("custom");
      el.playersInput.classList.remove("hidden");
      if(Number(el.playersInput.value) < 3) el.playersInput.value = "3";
      el.playersInput.focus();
      el.playersInput.select();
      storage.set(LS.playersMode, "custom");
      storage.set(LS.players, el.playersInput.value);
    }

    function setDifficulty(diff){
      state.difficulty = DIFF_KEYS.includes(diff) ? diff : "all";
      storage.set(LS.difficulty, state.difficulty);
      const btns = el.difficultySeg?.querySelectorAll(".segbtn") || [];
      btns.forEach(b => b.classList.toggle("active", b.dataset.diff === state.difficulty));
      state.deck = [];
      state.deckKey = "";
    }

    function setSelectedCats(keys){
      const normalized = (Array.isArray(keys) ? keys : [])
        .map(String)
        .map(s => s.trim())
        .filter(k => CATEGORY_KEYS.includes(k));

      state.selectedCats = Array.from(new Set(normalized));
      storage.set(LS.categories, state.selectedCats.join(","));
      state.deck = [];
      state.deckKey = "";
      renderCategoryChips();
    }

    function renderCategoryChips(){
      if(!el.categoryChips) return;
      ensureArrays();
      const selected = new Set(state.selectedCats);

      if(!el.categoryChips.dataset.ready){
        el.categoryChips.innerHTML = "";

        const allBtn = document.createElement("button");
        allBtn.type = "button";
        allBtn.className = "chip";
        allBtn.dataset.cat = "__all__";
        allBtn.addEventListener("click", () => setSelectedCats([]));
        el.categoryChips.appendChild(allBtn);

        for(const key of CATEGORY_KEYS){
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "chip";
          btn.dataset.cat = key;
          btn.addEventListener("click", () => {
            ensureArrays();
            const next = new Set(state.selectedCats);
            if(next.has(key)) next.delete(key);
            else next.add(key);
            setSelectedCats(Array.from(next));
          });
          el.categoryChips.appendChild(btn);
        }

        el.categoryChips.dataset.ready = "1";
      }

      const children = Array.from(el.categoryChips.children);
      for(const btn of children){
        const key = btn.dataset.cat;
        if(key === "__all__"){
          btn.classList.remove("logo");
          btn.textContent = t("all");
          btn.classList.toggle("active", state.selectedCats.length === 0);
          continue;
        }

        // Special: Kinojuha uses a logo instead of text
        if(key === "kinojuha"){
          btn.classList.add("logo");
          btn.classList.toggle("active", selected.has(key));
          const label = t("cat_kinojuha");
          btn.setAttribute("aria-label", label);
          btn.setAttribute("title", label);

          if(!btn.dataset.logoReady){
            btn.textContent = "";
            const img = document.createElement("img");
            img.src = "https://www.kinojuha.fi/hosting/kinojuha.fi/graphics/logo.png";
            img.alt = label;
            img.decoding = "async";
            img.loading = "lazy";
            img.addEventListener("error", () => {
              // Fallback to text if the logo can't be loaded
              btn.classList.remove("logo");
              btn.textContent = label;
            }, { once: true });
            btn.appendChild(img);
            btn.dataset.logoReady = "1";
          }else{
            const img = btn.querySelector("img");
            if(img) img.alt = label;
          }
          continue;
        }

        btn.classList.remove("logo");
        btn.textContent = t(`cat_${key}`);
        btn.classList.toggle("active", selected.has(key));
      }
    }

    function setHintBoxVisible(visible){
      if(!el.impostorHintBox) return;
      el.impostorHintBox.classList.toggle("hidden", !visible);
    }

    function revealCard(isRefresh=false){
      const isImpostor = (state.currentPlayer === state.impostorPlayer);
      const secret = state.secret;
      if(!el.cardMain || !el.cardLabel) return;

      const showHint = isImpostor && state.impostorHintEnabled && !!secret;

      if(isImpostor && !state.hiddenImpostorEnabled){
        el.cardLabel.classList.add("hidden");
        el.cardMain.textContent = t("youAreImpostor");
        el.cardMain.classList.add("imposter");

        if(showHint){
          const cats = getHintCategories(secret);
          if(el.impostorHintText) el.impostorHintText.textContent = categoryText(cats);
          if(el.impostorHintLabel) el.impostorHintLabel.textContent = (cats.length > 1) ? t("categoriesLabel") : t("category");
          setHintBoxVisible(true);
        }else{
          setHintBoxVisible(false);
        }
      }else{
        el.cardLabel.classList.remove("hidden");
        el.cardLabel.textContent = t("card_word");
        const entry = (isImpostor && state.hiddenImpostorEnabled) ? state.decoy : secret;
        el.cardMain.textContent = entry ? (entry[state.lang] || entry.en) : "";
        el.cardMain.classList.remove("imposter");

        if(showHint){
          const cats = getHintCategories(secret);
          if(el.impostorHintText) el.impostorHintText.textContent = categoryText(cats);
          if(el.impostorHintLabel) el.impostorHintLabel.textContent = (cats.length > 1) ? t("categoriesLabel") : t("category");
          setHintBoxVisible(true);
        }else{
          setHintBoxVisible(false);
        }
      }

      if(!isRefresh){
        el.faceDown?.classList.add("hidden");
        el.faceUp?.classList.remove("hidden");
      }
    }

    function hideCard(){
      el.faceUp?.classList.add("hidden");
      el.faceDown?.classList.remove("hidden");
    }

    function nextPlayer(){
      if(state.currentPlayer >= state.totalPlayers){
        finishDealing();
        return;
      }
      state.currentPlayer += 1;
      updateDealUI();
    }

    function startGame(){
      if(!el.playersInput) return;
      ensureArrays();

      const total = clampPlayers(el.playersInput.value);
      el.playersInput.value = String(total);
      storage.set(LS.players, total);

      state.impostorHintEnabled = !!el.impostorHintToggle?.checked;
      state.hiddenImpostorEnabled = !!el.hiddenImpostorToggle?.checked;
      storage.setBool(LS.hint, state.impostorHintEnabled);
      storage.setBool(LS.hidden, state.hiddenImpostorEnabled);

      state.pool = buildPool();
      if(!state.pool.length){
        alert(t("alertNoWords"));
        return;
      }

      state.totalPlayers = total;
      state.currentPlayer = 1;
      state.impostorPlayer = randInt(1, total);
      chooseSecret();
      state.decoy = state.hiddenImpostorEnabled ? chooseDecoyForSecret(state.secret) : null;
      state.dealing = true;

      showPanel("deal");
      updateDealUI();
      requestWakeLock();
    }

    function finishDealing(){
      state.dealing = false;
      hideCard();
      showPanel("done");
    }

    function newGame(){
      state.totalPlayers = 0;
      state.currentPlayer = 1;
      state.impostorPlayer = 0;
      state.secret = null;
      state.decoy = null;
      state.pool = [];
      state.dealing = false;

      showPanel("setup");
      releaseWakeLock();
    }

    // ---- Wake lock (best effort) ----
    let wakeLock = null;
    async function requestWakeLock(){
      try{
        if("wakeLock" in navigator){
          wakeLock = await navigator.wakeLock.request("screen");
        }
      }catch(_e){}
    }
    async function releaseWakeLock(){
      try{
        if(wakeLock){
          await wakeLock.release();
          wakeLock = null;
        }
      }catch(_e){}
    }

    // ---- Self tests (only when enabled) ----
    function shouldRunTests(){
      const query = /(?:\?|&)test=1(?:&|$)/.test(location.search);
      return query || storage.getBool(LS.selftest, false);
    }

    function showToast(msg){
      if(!el.toast) return;
      el.toast.textContent = msg;
      el.toast.classList.remove("hidden");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => el.toast?.classList.add("hidden"), 2400);
    }

    function runSelfTests(){
      const snap = {
        lang: state.lang,
        difficulty: state.difficulty,
        selectedCats: Array.isArray(state.selectedCats) ? state.selectedCats.slice() : [],
        pool: state.pool,
        deck: Array.isArray(state.deck) ? state.deck.slice() : [],
        deckKey: state.deckKey,
        secret: state.secret,
        decoy: state.decoy,
        dealing: state.dealing,
      };

      try{
        console.assert(WORD_BANK.length > 0, "WORD_BANK should not be empty");

        const pineapple = WORD_BANK.find(w => w.en === "Pineapple");
        console.assert(!!pineapple, "Test word missing: Pineapple");
        console.assert(pineapple?.fi === "Ananas", "Finnish translation should be Ananas");

        {
          const prev = state.lang;
          state.lang = "en";
          console.assert(categoryText(getHintCategories(pineapple)) === "Food / Nature", "Hint should include all categories (EN)");
          state.lang = "fi";
          console.assert(categoryText(getHintCategories(pineapple)) === "Ruoka / Luonto", "Hint should include all categories (FI)");
          state.lang = prev;
        }

        {
          const prevLang = state.lang;
          state.lang = "en";
          console.assert(categoryText(["space","vehicle","suomi"]) === "Space / Vehicle / Finland", "EN categoryText failed");
          console.assert(categoryText(["kinojuha","movies"]) === "Kinojuha / Movies", "EN categoryText Kinojuha failed");
          state.lang = "fi";
          console.assert(categoryText(["space","vehicle","suomi"]) === "Avaruus / Ajoneuvo / Suomi", "FI categoryText failed");
          console.assert(categoryText(["kinojuha","movies"]) === "Kinojuha / Elokuvat", "FI categoryText Kinojuha failed");
          state.lang = prevLang;
        }

        {
          const prevDiff = state.difficulty;
          const prevCats = Array.isArray(state.selectedCats) ? state.selectedCats.slice() : [];
          state.difficulty = "hard";
          state.selectedCats = ["space"];
          const pool = buildPool();
          console.assert(pool.every(w => w.diff === "hard"), "Pool should be hard only");
          console.assert(pool.every(w => w.cats.includes("space")), "Pool should be space category");
          state.difficulty = prevDiff;
          state.selectedCats = prevCats;
        }

        {
          const prevPool = state.pool;
          const rocket = WORD_BANK.find(w => w.en === "Rocket");
          console.assert(!!rocket, "Test word missing: Rocket");
          state.pool = WORD_BANK.filter(w => w.cats.includes("space"));
          const decoy = chooseDecoyForSecret(rocket);
          console.assert(decoy && decoy !== rocket, "Decoy should exist and differ from secret");
          console.assert(intersectsCats(normalizeCats(decoy), normalizeCats(rocket)), "Decoy should share a category");
          state.pool = prevPool;
        }

        if(el.impostorHintToggle && el.impostorHintState){
          const prevLang = state.lang;
          const prev = el.impostorHintToggle.checked;
          el.impostorHintToggle.checked = false;
          updateToggleStateLabels();
          console.assert(el.impostorHintState.textContent === I18N[prevLang].toggle_off, "Toggle OFF label should match language");
          el.impostorHintToggle.checked = prev;
          updateToggleStateLabels();
        }

        {
          const prevDiff = state.difficulty;
          const prevCats = Array.isArray(state.selectedCats) ? state.selectedCats.slice() : [];
          state.difficulty = "all";
          state.selectedCats = ["suomi"];
          const p = buildPool();
          console.assert(p.length > 0, "Suomi pool should not be empty");
          console.assert(p.every(w => w.cats.includes("suomi")), "Suomi pool words should include 'suomi' category");
          console.assert(p.some(w => w.fi === "Helsinki"), "Suomi pool should include Helsinki");
          state.difficulty = prevDiff;
          state.selectedCats = prevCats;
        }

        {
          const prevPool = state.pool;
          const prevDeck = Array.isArray(state.deck) ? state.deck.slice() : [];
          const prevKey = state.deckKey;
          const prevDiff = state.difficulty;
          const prevCats = Array.isArray(state.selectedCats) ? state.selectedCats.slice() : [];
          const prevLast = storage.get(LS.lastSecret, "");

          const fake = [
            { en:"A", fi:"A", cats:["thing"], diff:"easy" },
            { en:"B", fi:"B", cats:["thing"], diff:"easy" },
            { en:"C", fi:"C", cats:["thing"], diff:"easy" }
          ];

          state.pool = fake;
          state.difficulty = "all";
          state.selectedCats = [];
          state.deck = [];
          state.deckKey = "";
          storage.set(LS.lastSecret, "");

          const picks = [];
          chooseSecret(); picks.push(state.secret?.en);
          chooseSecret(); picks.push(state.secret?.en);
          chooseSecret(); picks.push(state.secret?.en);
          const uniq = new Set(picks.filter(Boolean));
          console.assert(uniq.size === 3, "Deck should yield 3 unique picks before repeating");

          state.pool = prevPool;
          state.deck = prevDeck;
          state.deckKey = prevKey;
          state.difficulty = prevDiff;
          state.selectedCats = prevCats;
          storage.set(LS.lastSecret, prevLast);
        }

      } finally {
        state.lang = snap.lang;
        state.difficulty = snap.difficulty;
        state.selectedCats = snap.selectedCats.slice();
        state.pool = snap.pool;
        state.deck = snap.deck.slice();
        state.deckKey = snap.deckKey;
        state.secret = snap.secret;
        state.decoy = snap.decoy;
        state.dealing = snap.dealing;

        console.assert(state.difficulty === snap.difficulty, "Self-tests must not change difficulty");
        console.assert(Array.isArray(state.selectedCats) && state.selectedCats.join(",") === snap.selectedCats.join(","), "Self-tests must not change categories");

        const btns = el.difficultySeg?.querySelectorAll(".segbtn") || [];
        btns.forEach(b => b.classList.toggle("active", b.dataset.diff === state.difficulty));
        renderCategoryChips();
        updateToggleStateLabels();
      }
    }

    function runSelfTestsWithReport(){
      const origAssert = console.assert;
      let fails = 0;
      console.assert = function(cond, ...args){
        if(!cond) fails += 1;
        origAssert.call(console, cond, ...args);
      };
      try{
        runSelfTests();
      }catch(e){
        fails += 1;
        console.error("Self-test threw:", e);
      }finally{
        console.assert = origAssert;
      }
      return { fails };
    }

    function setSelfTestEnabled(enabled, opts={runNow:false}){
      storage.setBool(LS.selftest, !!enabled);
      if(el.selfTestBtn){
        el.selfTestBtn.classList.toggle("active", !!enabled);
        el.selfTestBtn.setAttribute("aria-label", t("selfTest"));
        el.selfTestBtn.title = t("selfTest");
      }
      if(opts.runNow){
        const report = runSelfTestsWithReport();
        if(report.fails === 0) showToast(t("testsPassed"));
        else showToast(t("testsFailed", report.fails));
      }else{
        showToast(!!enabled ? t("testsOn") : t("testsOff"));
      }
    }

    const REPO_URL = "https://github.com/mielipuolinen/word-impostor/";

    function openRepo(){
      try{
        const w = window.open(REPO_URL, "_blank", "noopener,noreferrer");
        if(!w) location.href = REPO_URL;
      }catch(_e){
        location.href = REPO_URL;
      }
    }

    function init(){
      ensureArrays();

      // Language
      setLanguage(detectInitialLanguage());

      // Restore toggles
      if(el.impostorHintToggle) el.impostorHintToggle.checked = storage.getBool(LS.hint, false);
      if(el.hiddenImpostorToggle) el.hiddenImpostorToggle.checked = storage.getBool(LS.hidden, false);
      updateToggleStateLabels();

      // Restore difficulty
      const savedDiff = storage.get(LS.difficulty, "all");
      state.difficulty = DIFF_KEYS.includes(savedDiff) ? savedDiff : "all";
      const btns = el.difficultySeg?.querySelectorAll(".segbtn") || [];
      btns.forEach(b => b.classList.toggle("active", b.dataset.diff === state.difficulty));

      // Restore categories
      const savedCats = (storage.get(LS.categories, "") || "").split(",").map(s => s.trim()).filter(Boolean);
      setSelectedCats(savedCats);

      // Persist on change
      el.impostorHintToggle?.addEventListener("change", () => {
        storage.setBool(LS.hint, !!el.impostorHintToggle.checked);
        updateToggleStateLabels();
      });
      el.hiddenImpostorToggle?.addEventListener("change", () => {
        storage.setBool(LS.hidden, !!el.hiddenImpostorToggle.checked);
        updateToggleStateLabels();
      });

      // Difficulty clicks
      el.difficultySeg?.addEventListener("click", (e) => {
        const btn = e.target.closest("button.segbtn");
        if(!btn) return;
        setDifficulty(btn.dataset.diff);
      });

      // Player count restore
      const savedPlayers = clampPlayers(storage.get(LS.players, 5));
      const mode = storage.get(LS.playersMode, "preset");
      if([3,4,5,6].includes(savedPlayers) && mode !== "custom") usePresetCount(savedPlayers);
      else{
        if(el.playersInput) el.playersInput.value = String(savedPlayers);
        useCustomCount();
      }

      // Quick buttons
      el.playerQuick?.addEventListener("click", (e) => {
        const btn = e.target.closest("button.quickbtn");
        if(!btn) return;
        const v = btn.dataset.count;
        if(v === "custom") useCustomCount();
        else usePresetCount(clampPlayers(v));
      });

      // Custom input changes -> keep storage updated
      el.playersInput?.addEventListener("input", () => {
        if(el.playersInput.classList.contains("hidden")) return;
        storage.set(LS.players, clampPlayers(el.playersInput.value));
      });

      // Enter key starts
      el.playersInput?.addEventListener("keydown", (e) => {
        if(e.key === "Enter") startGame();
      });

      // Language buttons
      el.langEn?.addEventListener("click", () => setLanguage("en"));
      el.langFi?.addEventListener("click", () => setLanguage("fi"));

      // Main actions
      el.startBtn?.addEventListener("click", startGame);
      el.revealBtn?.addEventListener("click", () => revealCard(false));
      el.closeCardBtn?.addEventListener("click", () => { hideCard(); nextPlayer(); });
      el.newGameBtn?.addEventListener("click", newGame);

      document.addEventListener("visibilitychange", () => {
        if(state.dealing && document.visibilityState === "visible") requestWakeLock();
      });

      // Repo button (subtle)
      if(el.repoBtn){
        el.repoBtn.setAttribute("aria-label", t("repo"));
        el.repoBtn.title = t("repo");
        el.repoBtn.addEventListener("click", openRepo);
      }

      // Self-test toggle button (subtle)
      if(el.selfTestBtn){
        const enabled = storage.getBool(LS.selftest, false);
        el.selfTestBtn.classList.toggle("active", enabled);
        el.selfTestBtn.setAttribute("aria-label", t("selfTest"));
        el.selfTestBtn.title = t("selfTest");
        el.selfTestBtn.addEventListener("click", () => {
          const now = !storage.getBool(LS.selftest, false);
          setSelfTestEnabled(now, { runNow: now });
        });
      }

      showPanel("setup");

      if(shouldRunTests()){
        const report = runSelfTestsWithReport();
        if(storage.getBool(LS.selftest, false)){
          if(report.fails === 0) showToast(t("testsPassed"));
          else showToast(t("testsFailed", report.fails));
        }
      }

      if(!WORD_BANK.length){
        console.warn("No words loaded. Add words under <script id=wordData type=application/json>.");
      }
    }

    init();
  </script>
</body>
</html>
